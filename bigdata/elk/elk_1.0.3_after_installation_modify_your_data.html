<!DOCTYPE html>
<html lang="zh-cmn">

<head>
    <title>XTY Blog | Linux Ops Docs | SRE | DEVOPS</title>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <link rel="stylesheet" href="/static/css/chroma.css">
    <link rel="stylesheet" href="/static/css/main.css">
</head>

<div class="blog-title">
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<div>
					<a class="main-title" href="/">XTY的小站</a>
                </div>
                <div>
                    <a class="small-title" href="/">记录技术笔记和技术博客</a>
                </div>
			</div>
		</div>
	</div>
</div>

<body>
  <div class="container">

    <div class="col-lg-4 col-lg-offset-1 col-md-4 col-md-offset-1 col-sm-4 col-sm-offset-1">
	  <div id="sidebar">

		<h3>最新文章</h3>
          <ul>

            <li>
              <a href="/service/nginx/nginx_2.1.9.03_configuration_log.html">nginx: 配置 - 日志</a>
            </li>
            <li>
              <a href="/linux/advance/network_tunnel-ipip.html">网络: 隧道 - IPIP</a>
            </li>
            <li>
              <a href="/linux/advance/network_ip-address.html">网络: IP - IP地址简介</a>
            </li>
            <li>
              <a href="/linux/advance/bash_02_00_login_shell_vs_non_login_shell.html">bash: login shell vs non-login shell</a>
            </li>
            <li>
              <a href="/linux/advance/rlimit_fd_02_commands_to_check_current_status.html">rlimit fd: 状态查看命令</a>
            </li>
          </ul>

		<h3>文章分类</h3>
		  <ul>

            <li>
              <a href="/android/index.html">android</a>
            </li>
            <li>
              <a href="/bigdata/index.html">bigdata</a>
              <ul>
                <li>
                  <a href="/bigdata/cloudera/index.html">cloudera</a>
                </li>
                <li>
                  <a href="/bigdata/elk/index.html">elk</a>
                  <ul>
                    <li><a href="/bigdata/elk/elasticsearch_1.1.0_docker_installation.html">elasticsearch 1.1.0: docker installation</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.0_elasticsearch_concept.html">elk 1.0.0: elasticsearch concept</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.1_elasticsearch_removal_of_mapping_types.html">elk 1.0.1: elasticsearch removal of mapping types</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.2_after_installation_explore_your_cluster.html">elk 1.10.2: explore you cluster</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.3_after_installation_modify_your_data.html">elk 1.0.3: modify your data</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.4_after_installation_explore_your_data.html">elk 1.0.4: explore your data</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.5_elasticsearch_index_templates.html">elk 1.0.5: elasticsearch index templates</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.6_elasticsearch_mapping.html">elk 1.0.6: elasticsearch mapping</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.7.a_elasticsearch_cluster_api_cluster_setting.html">elk 1.0.7.a: elasticsearch cluster api - cluster setting</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.8.a_elasticsearch_modules_snapshot_and_restore.html">elk 1.0.8.a: elasticsearch modules - snapshot and restore</a></li>
                    <li><a href="/bigdata/elk/elk_1.1.0_production_installation.html">elk 1.1.0: production installation</a></li>
                    <li><a href="/bigdata/elk/elk_1.1.1_production_installation_add_xpack.html">elk 1.1.1: production installation add xpack</a></li>
                    <li><a href="/bigdata/elk/elk_1.2.0_elasticsearch_upgrade_from_6.2.4_to_6.4.2.html">elk 1.2.0: elasticsearch upgrade from 6.2.4 to 6.4.2</a></li>
                    <li><a href="/bigdata/elk/elk_2.1.0_conf_logstash_index_name_date.html">elk 2.1.0 logstash config index name with current date</a></li>
                    <li><a href="/bigdata/elk/elk_2.2.0_conf_filebeat_logstash_kafka.html">elk 2.2.0 config kafka with filebeat and logstash</a></li>
                    <li><a href="/bigdata/elk/elk_2.2.1_error_filebeat_kafka_waiting_for_space.html">elk 2.2.1 config kafka with filebeat and logstash</a></li>
                    <li><a href="/bigdata/elk/elk_3.1.0_logstash_plugin_grok.html">elk 3.1.0 logstash plugin grok</a></li>
                    <li><a href="/bigdata/elk/elk_3.2.0_logstash_plugin_geoip_and_kibana_visualize.html">elk 3.2.0 logstash plugin geoip and kibana visualize</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li>
              <a href="/blockchain/index.html">blockchain</a>
            </li>
            <li>
              <a href="/blog/index.html">blog</a>
            </li>
            <li>
              <a href="/cloud/index.html">cloud</a>
            </li>
            <li>
              <a href="/cryptography/index.html">cryptography</a>
            </li>
            <li>
              <a href="/database/index.html">database</a>
            </li>
            <li>
              <a href="/devops/index.html">devops</a>
            </li>
            <li>
              <a href="/go/index.html">go</a>
            </li>
            <li>
              <a href="/ios/index.html">ios</a>
            </li>
            <li>
              <a href="/java/index.html">java</a>
            </li>
            <li>
              <a href="/linux/index.html">linux</a>
            </li>
            <li>
              <a href="/python/index.html">python</a>
            </li>
            <li>
              <a href="/service/index.html">service</a>
            </li>
            <li>
              <a href="/virtualization/index.html">virtualization</a>
            </li>
            <li>
              <a href="/web/index.html">web</a>
            </li>
          </ul>

      </div>
    </div>

    <div class="col-lg-7 col-md-7 col-sm-7">
      <h2>elk 1.0.3: modify your data</h2>
      <div>
        <hr style="border: 0; border-top: 1px dashed #a2a9b6">
      </div>
      <div class="postDate">
        <p>17 Oct 2018</p>
      </div>
      <div>
        <hr style="border: 0; border-bottom: 1px dashed #a2a9b6">
      </div>
<h2>Modifying Your Data</h2>

<p>Elasticsearch提供几乎实时的数据操作和搜索功能。默认情况下，在执行索引、更新
删除数据操作直到搜索结果出现，你可以有个大概一秒的延迟预期。这是与SQL等其他平台的重要区别，它们的数据在事务完成后是立即可用的。</p>

<h3>1. Indexing/Replacing Documents</h3>

<p>前面我们已经演示过如何索引一个文档:</p>
<pre class="chroma">PUT /customer/_doc/1?pretty
{
  &#34;name&#34;: &#34;John Doe&#34;
}
</pre>
<p>同样的，上面的命令会索引一个ID为1的文档到customer索引中。如果我们再次用不同或相同的内容执行上面的动作，elasticsearch会重新替换（重新索引）一个ID为1的文档：</p>
<pre class="chroma">PUT /customer/_doc/1?pretty
{
  &#34;name&#34;: &#34;Jane Doe&#34;
}
</pre>
<p>上面的操作将ID为1的文档中的“name”从“John Doe”更换成了“Jane Doe”。换句话说，另一方面，如果我们使用不同的ID号码，一个新的文档会被索引，而旧有的数据不会变更。</p>
<pre class="chroma">PUT /customer/_doc/2?pretty
{
  &#34;name&#34;: &#34;Jane Doe&#34;
}
</pre>
<p>上面的操作创建了一个新的ID为2的文档。</p>

<p>当索引新文档时，URL的ID部分是可选的。如果没有指定ID，elasticsearch会随机生成一个ID来分配给新的被索引的文档。Elasticsearch生成的实际ID（或前面示例中显式指定的内容）将作为索引API调用的一部分返回。</p>

<p>下面的例子展示了如何在不指定ID的情况下索引新文档：</p>
<pre class="chroma">POST /customer/_doc?pretty
{
  &#34;name&#34;: &#34;Jane Doe&#34;
}
</pre>
<p>值得注意的是，上面的例子中我们使用POST来替代了PUT，因为我们没有指定ID。</p>

<h3>2. Updating Documents</h3>

<p>除了能够索引和替换文档，我们还可以更新文档。请注意，Elasticsearch实际上并没有在内部进行就地更新。每当我们进行更新文档操作时，Elasticsearch都会删除旧文档，然后将更新后的文档内容索引成新文档。</p>

<p>下面是一个更新ID位1的文档的name为Jane Doe的例子:</p>
<pre class="chroma">POST /customer/_doc/1/_update?pretty
{
  &#34;doc&#34;: { &#34;name&#34;: &#34;Jane Doe&#34; }
}
</pre>
<p>下面的例子，除了更新name之外，扩展增加了一个age的内容:</p>
<pre class="chroma">POST /customer/_doc/1/_update?pretty
{
  &#34;doc&#34;: { &#34;name&#34;: &#34;Jane Doe&#34;, &#34;age&#34;: 20 }
}
</pre>
<p>更新操作也可以执行一个简单的脚本，下面的例子给上面的age增加了5岁:</p>
<pre class="chroma">POST /customer/_doc/1/_update?pretty
{
  &#34;script&#34; : &#34;ctx._source.age += 5&#34;
}
</pre>
<p>在上面的例子中，<code>ctx._source</code>指向的是要被更新的源文档。</p>

<p>Elasticsearch提供了在给定查询条件（如SQL UPDATE-WHERE语句）的情况下更新多个文档的功能。请参阅<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/docs-update-by-query.html">docs-update-by-query API</a></p>

<h3>3. Deleting Documents</h3>

<p>删除文档的操作相当直观。下面的例子展示了如何删除ID为2的文档：</p>
<pre class="chroma">DELETE /customer/_doc/2?pretty
</pre>
<p>可以查看<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/docs-delete-by-query.html"><code>_delete_by_query API</code></a>来实现根据查询语句来删除所有符合条件的文档。特别值得注意的是，删除整个索引比按照查询删除API来删除所有的文档来的更高效。</p>

<h3>4. Batch Processing</h3>

<p>除了能够索引，更新和删除单个文档之外，Elasticsearch还提供了使用<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/docs-bulk.html"><code>_bulk API</code></a>批量执行上述任何操作的功能。这个功能很重要，它提供了一个高效的机制来完成多个操作，是在尽量少的网络回路下尽可能快的完成。</p>

<p>下面的示例批量索引了两个文档(ID 1 - John Doe and ID 2 - Jane Doe)：</p>
<pre class="chroma">POST /customer/_doc/_bulk?pretty
{&#34;index&#34;:{&#34;_id&#34;:&#34;1&#34;}}
{&#34;name&#34;: &#34;John Doe&#34; }
{&#34;index&#34;:{&#34;_id&#34;:&#34;2&#34;}}
{&#34;name&#34;: &#34;Jane Doe&#34; }
</pre>
<p>下面的示例批量执行id为1的文档的更新和id为2的文档的删除操作：</p>
<pre class="chroma">POST /customer/_doc/_bulk?pretty
{&#34;update&#34;:{&#34;_id&#34;:&#34;1&#34;}}
{&#34;doc&#34;: { &#34;name&#34;: &#34;John Doe becomes Jane Doe&#34; } }
{&#34;delete&#34;:{&#34;_id&#34;:&#34;2&#34;}}
</pre>
<p>请注意，对于删除操作，之后没有相应的源文档，因为删除只需要删除文档的ID。</p>

<p>Bulk API不会因其中一个操作失败而失败。如果单个操作因任何原因失败，它将继续处理其后的其余操作。Bulk API返回时，它将为每个操作提供一个状态（按照发送的顺序），以便您可以检查特定操作是否失败。</p>

    </div>

  </div>
</body>

<footer>
    <div class="container">
        <div class="row footer-links">
            <div class="col-lg-2 col-sm-2">
                <h3>友情链接</h3>
                <ul>
                    <li><a href="">友链位招租</a></li>
                    <li><a href="">友链位招租</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>没想好</h3>
                <ul>
                    <li><a href="">我爸没想好</a></li>
                    <li><a href="">我哥说我爸没想好</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>Hooray</h3>
                <ul>
                    <li><a href="">Hooray</a></li>
                    <li><a href="">What are we Hooray For?</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>前面的footer太浪了</h3>
                <ul>
                    <li><a href="">就是就是</a></li>
                    <li><a href="">偷偷的表示羡慕</a></li>
                </ul>
            </div>
            <div class="col-lg-4 col-sm-4">
                <h3>网站信息</h3>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <div class="fine-print">
                    <p>网战由以下技术支撑</p>
                    <ul>
                        <li>Markdown Processor: <a href="https://github.com/russross/blackfriday/tree/v2">Blackfriday V2</a></li>
                        <li>Renderer Engine: <a href="https://github.com/Depado/bfchroma/">bfchroma</a></li>
                        <li>Syntax Highlighter: <a href="https://github.com/alecthomas/chroma">Chroma</a></li>
                        <li>Coding Language: <a href="https://go.dev/">Golang</a></li>
                        <li>Others: Markdown, HTML, CSS</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>

</html>