<!DOCTYPE html>
<html lang="zh-cmn">

<head>
    <title>XTY Blog | Linux Ops Docs | SRE | DEVOPS</title>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <link rel="stylesheet" href="/static/css/chroma.css">
    <link rel="stylesheet" href="/static/css/main.css">
</head>

<div class="blog-title">
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<div>
					<a class="main-title" href="/">XTY的小站</a>
                </div>
                <div>
                    <a class="small-title" href="/">记录技术笔记和技术博客</a>
                </div>
			</div>
		</div>
	</div>
</div>

<body>
  <div class="container">

    <div class="col-lg-4 col-lg-offset-1 col-md-4 col-md-offset-1 col-sm-4 col-sm-offset-1">
	  <div id="sidebar">

		<h3>最新文章</h3>
          <ul>

            <li>
              <a href="/service/nginx/nginx_2.1.9.03_configuration_log.html">nginx: 配置 - 日志</a>
            </li>
            <li>
              <a href="/linux/advance/network_tunnel-ipip.html">网络: 隧道 - IPIP</a>
            </li>
            <li>
              <a href="/linux/advance/network_ip-address.html">网络: IP - IP地址简介</a>
            </li>
            <li>
              <a href="/linux/advance/bash_02_00_login_shell_vs_non_login_shell.html">bash: login shell vs non-login shell</a>
            </li>
            <li>
              <a href="/linux/advance/rlimit_fd_02_commands_to_check_current_status.html">rlimit fd: 状态查看命令</a>
            </li>
          </ul>

		<h3>文章分类</h3>
		  <ul>

            <li>
              <a href="/android/index.html">android</a>
            </li>
            <li>
              <a href="/bigdata/index.html">bigdata</a>
            </li>
            <li>
              <a href="/blockchain/index.html">blockchain</a>
            </li>
            <li>
              <a href="/blog/index.html">blog</a>
            </li>
            <li>
              <a href="/cloud/index.html">cloud</a>
            </li>
            <li>
              <a href="/cryptography/index.html">cryptography</a>
            </li>
            <li>
              <a href="/database/index.html">database</a>
            </li>
            <li>
              <a href="/devops/index.html">devops</a>
            </li>
            <li>
              <a href="/go/index.html">go</a>
            </li>
            <li>
              <a href="/ios/index.html">ios</a>
            </li>
            <li>
              <a href="/java/index.html">java</a>
            </li>
            <li>
              <a href="/linux/index.html">linux</a>
              <ul>
                <li>
                  <a href="/linux/advance/index.html">advance</a>
                </li>
                <li>
                  <a href="/linux/basic/index.html">basic</a>
                </li>
                <li>
                  <a href="/linux/desktop/index.html">desktop</a>
                </li>
                <li>
                  <a href="/linux/other/index.html">other</a>
                  <ul>
                    <li><a href="/linux/other/RHCE考试答案.html">RHCE考试答案</a></li>
                    <li><a href="/linux/other/RHCSA考试答案.html">RHCSA考试答案</a></li>
                  </ul>
                </li>
                <li>
                  <a href="/linux/service/index.html">service</a>
                </li>
                <li>
                  <a href="/linux/shell/index.html">shell</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="/python/index.html">python</a>
            </li>
            <li>
              <a href="/service/index.html">service</a>
            </li>
            <li>
              <a href="/virtualization/index.html">virtualization</a>
            </li>
            <li>
              <a href="/web/index.html">web</a>
            </li>
          </ul>

      </div>
    </div>

    <div class="col-lg-7 col-md-7 col-sm-7">
      <h2>RHCE考试答案</h2>
      <div>
        <hr style="border: 0; border-top: 1px dashed #a2a9b6">
      </div>
      <div class="postDate">
        <p>19 Sep 2015</p>
      </div>
      <div>
        <hr style="border: 0; border-bottom: 1px dashed #a2a9b6">
      </div>
<h2>考试环境部署：</h2>

<h3>1. 优盘根目录执行以下命令(classroom)</h3>
<pre class="chroma">yum install -y ./examrhce-0.0.1-1.el7.x86_64.rpm
</pre>
<h3>2. server/desktop执行以下命令(server/desktop)</h3>
<pre class="chroma">lab examrhce setup
</pre>
<h3>3. 评分命令</h3>
<pre class="chroma">lab examrhce grade
</pre>
<h2>考题答案</h2>

<h3>第1题：SELINUX配置(server&amp;desktop)</h3>

<h4>1) 修改配置</h4>
<pre class="chroma">vi /etc/sysconfig/selinux
***********************************
<span class="nv">SELINUX</span><span class="o">=</span>enforcing
***********************************
</pre>
<h4>2) 修改目前状态</h4>
<pre class="chroma">setenforce <span class="m">1</span>
</pre>
<h4>3) 查看状态</h4>
<pre class="chroma">getenforce
</pre>
<h3>第2题：配置防火墙对SSH的限制(server&amp;desktop)</h3>

<h4>1) 关闭iptables/ip6tables/ebtables</h4>
<pre class="chroma">systemctl mask iptables
systemctl mask ip6tables
systemctl mask ebtables
</pre>
<h4>2) 开启firewalld并设为开机启动</h4>
<pre class="chroma">systemctl <span class="nb">enable</span> firewalld
systemctl start firewalld
</pre>
<h4>3)  创建规则</h4>
<pre class="chroma"><span class="c1">#允许ssh服务</span>
firewall-cmd --permanent --add-service<span class="o">=</span>ssh
<span class="c1">#禁止特定域(ip段)访问ssh</span>
firewall-cmd --permanent --add-rich-rule<span class="o">=</span><span class="s1">&#39;rule family=ipv4 source address=172.17.0.0/24 service name=ssh reject&#39;</span>
</pre>
<h4>4)  重新加载规则使其生效</h4>
<pre class="chroma">firewall-cmd --reload
</pre>
<h4>5)  检查规则</h4>
<pre class="chroma">firewall-cmd --list-all
</pre>
<h3>第3题：配置ipv6地址(server&amp;desktop)</h3>

<h4>1) 图形界面改ipv6</h4>
<pre class="chroma">nm-connection-editor
</pre>
<h4>2) reload配置和重启网卡</h4>
<pre class="chroma">nmcli con reload
nmcli con down eth0
nmcli con up eth0
</pre>
<h4>3) 查看ip</h4>
<pre class="chroma">ip a
ping ip address  <span class="o">(</span>互相ping一下<span class="o">)</span>
</pre>
<h3>第4题：配置链路聚合(server&amp;desktop)</h3>

<h4>1) 查看网卡链路</h4>
<pre class="chroma">ip link
</pre>
<h4>2) 创建team类型的网卡，连接别名是team0，使用的模式是activebackup</h4>
<pre class="chroma">nmcli con add <span class="nb">type</span> team con-name team0 ifname team0 config <span class="s1">&#39;{&#34;runner&#34;:{&#34;name&#34;:&#34;activebackup&#34;}}&#39;</span>
</pre>
<h4>3) 给team0网卡设置ip</h4>
<pre class="chroma">nmcli con mod team0 ipv4.addresses <span class="s1">&#39;192.168.0.101/24&#39;</span>
nmcli con mod team0 ipv4.method manual
</pre>
<h4>4) 给team0网卡指定从接口</h4>
<pre class="chroma">nmcli con add <span class="nb">type</span> team-slave con-name team0-port1 ifname eth1 master team0
nmcli con add <span class="nb">type</span> team-slave con-name team0-port2 ifname eth2 master team0
</pre>
<h4>5) 检查效果</h4>
<pre class="chroma">teamdctl team0 state
ping 192.168.0.254
</pre>
<h3>第5题：自定义用户环境(server&amp;desktop)</h3>

<h4>1) 在/etc/bashrc最后添加以下</h4>
<pre class="chroma">vim /etc/bashrc
********************************
<span class="nb">alias</span> <span class="nv">qstat</span><span class="o">=</span><span class="s1">&#39;/bin/ps -Ao pid,tt,user,fname,rsz&#39;</span>
********************************
</pre>
<h4>2) 新开终端检查</h4>
<pre class="chroma">which qstat
</pre>
<h3>第6题：配置本地邮件服务(server&amp;desktop)</h3>

<h4>1) 启动postfix服务</h4>
<pre class="chroma">systemctl <span class="nb">enable</span> postfix
systemctl restart postfix
</pre>
<h4>2) 配置postfix</h4>
<pre class="chroma">postconf -e <span class="s2">&#34;inet_interfaces = loopback-only&#34;</span>  配置网卡
postconf -e <span class="s2">&#34;myorigin = example.com&#34;</span>           配置邮件来源
postconf -e <span class="s2">&#34;relayhost = [classroom.example.com]&#34;</span> 配置邮件下一跳地址
postconf -e <span class="s2">&#34;mydestination = &#34;</span>                 为空表示不接受任何外网邮件
postconf -e <span class="s2">&#34;local_transport = error: local delivery disabled&#34;</span>
postconf -e <span class="s2">&#34;mynetworks = 127.0.0.1/8, [::1]/128&#34;</span>  允许本地ip来访问
</pre>
<h4>3) 重启postfix服务</h4>
<pre class="chroma">systemctl restart postfix
</pre>
<h4>4) 发送测试邮件</h4>
<pre class="chroma">mail -s <span class="s2">&#34;server0 null client&#34;</span> student@classroom.example.com
null client <span class="nb">test</span>                     此处为输入内容
.                                    此处为输入内容
EOT
</pre>
<h4>5) 检查邮件</h4>

<p>浏览器输入&rdquo;classroom.exam.com/cgi-bin/recevied_mail&rdquo;检查邮件</p>
<pre class="chroma"><span class="c1">#如果没有发送成功，可以检查发送队列</span>
mailq
</pre>
<h3>第7题：配置端口转发(server)</h3>

<h4>1) 配置防火墙规则</h4>
<pre class="chroma">firewall-cmd --permanent --add-rich-rule<span class="o">=</span><span class="s1">&#39;rule family=ipv4 source address=172.25.0.0/24 forward-port port=5423 protocol=tcp to-port=80&#39;</span>
</pre>
<h4>2) 重载规则</h4>
<pre class="chroma">firewall-cmd --reload
</pre>
<h3>第8题：配置samba服务(server)</h3>

<h4>1) 安装samba</h4>
<pre class="chroma">yum install samba samba-client -y
</pre>
<h4>2) 建立目录和用户(创建之前检查是否已存在)</h4>
<pre class="chroma">mkdir /common
useradd -s /sbin/nologin rob
useradd -s /sbin/nologin brian
</pre>
<h4>3) 将用户加入到samba里，并设置密码</h4>
<pre class="chroma">smbpasswd -a rob
smbpasswd -a brian
</pre>
<h4>4) 更改目标目录权限</h4>
<pre class="chroma">chown :brian /common/
chmod <span class="m">2775</span> /common/
ll -d /common/
</pre>
<h4>5) 更改selinux的安全</h4>
<pre class="chroma">semanage fcontext -a -t samba_share_t <span class="s1">&#39;/common(/.*)?&#39;</span>
restorecon -vFR /common/
</pre>
<h4>6) 更改samba配置文件</h4>
<pre class="chroma">vim /etc/samba/smb.conf
*****************************************
<span class="c1">#修改</span>
<span class="nv">workgroup</span> <span class="o">=</span> STAFF
<span class="nv">security</span> <span class="o">=</span> user
<span class="c1">#增加</span>
<span class="o">[</span>common<span class="o">]</span>
<span class="nv">path</span><span class="o">=</span>/common
write <span class="nv">list</span> <span class="o">=</span> brian
<span class="nv">browseable</span> <span class="o">=</span> yes
hosts <span class="nv">allow</span> <span class="o">=</span> 172.25.0.          <span class="c1"># 172网段</span>
*****************************************
</pre>
<h4>7) 启动服务</h4>
<pre class="chroma">systemctl <span class="nb">enable</span> smb nmb
systemctl start smb nmb
</pre>
<h4>8) 防火墙放行samba</h4>
<pre class="chroma">firewall-cmd --permanent --add-service<span class="o">=</span>samba
firewall-cmd --reload
</pre>
<h3>第9题：配置多用户samba挂载(client)</h3>

<h4>1) 安装cifs-tuils包</h4>
<pre class="chroma">yum install cifs-utils -y
</pre>
<h4>2) 创建挂载目录</h4>
<pre class="chroma">mkdir /mnt/multiuser
</pre>
<h4>3) 创建配置文件</h4>
<pre class="chroma"><span class="nb">echo</span> <span class="s1">&#39;username=brian&#39;</span> &gt; /root/smb-multiuser.txt            <span class="c1"># 名称自定义</span>
<span class="nb">echo</span> <span class="s1">&#39;password=redhat&#39;</span> &gt;&gt; /root/smb-multiuser.txt          <span class="c1"># 注意配置文件名称保持一致</span>
</pre>
<h4>4) 把挂载信息添加到fstab</h4>
<pre class="chroma">vi /etc/fstab
**********************************
//server0.example.com/common /mnt/multiuser cifs <span class="nv">credentials</span><span class="o">=</span>/root/smb-multiuser.txt,multiuser,sec<span class="o">=</span>ntlmssp <span class="m">0</span> <span class="m">0</span>
**********************************
</pre>
<h4>5) 挂载</h4>
<pre class="chroma">mount -a              <span class="c1"># 把fstab里的所有挂载配置挂载</span>
df -h                 <span class="c1"># 检查挂载结果</span>
</pre>
<h4>6) 检查client上是否有brian和rob，如不存在则创建</h4>
<pre class="chroma">id rob
id brian
</pre>
<h4>7) 多用户环境的credentials管理</h4>
<pre class="chroma">su - brian
cifscreds add server0
Password:
<span class="c1">#检查brian用户是否可读写</span>
 
su - rob
cifscreds add server0
Password:
<span class="c1">#检查rob用户是否是只读</span>
</pre>
<h3>第10题：配置NFS服务(server)</h3>

<h4>1) 服务</h4>
<pre class="chroma"><span class="c1"># 安装nfs软件包</span>
yum install -y nfs-utils
systemctl <span class="nb">enable</span> nfs-server
systemctl start nfs-server
</pre>
<h4>2) 目录</h4>
<pre class="chroma"><span class="c1"># 创建未加密共享目录</span>
mkdir /public
chown nfsnobody /public
<span class="c1"># 创建kerberos加密共享目录</span>
mkdir /protected/project -p
chown ldapuser0:ldapuser0 /protected/project
</pre>
<h4>3) 配置文件</h4>
<pre class="chroma"><span class="c1"># exports配置</span>
vi /etc/exports
**************************************
/protected *.example.com<span class="o">(</span>rw,sec<span class="o">=</span>krb5p<span class="o">)</span> <span class="c1"># krb的必须放首位，并且域要和其他的规则一致</span>
/public *.example.com<span class="o">(</span>ro<span class="o">)</span>
**************************************
exportfs -r
exportfs

<span class="c1"># nfs全局配置</span>
vi /etc/sysconfig/nfs
***********************************
<span class="nv">RPCNFSDRAGS</span><span class="o">=</span><span class="s2">&#34;-V 4.2&#34;</span>
***********************************
</pre>
<h4>4) 防火墙配置</h4>
<pre class="chroma">firewall-cmd --permanent --add-service<span class="o">=</span>nfs
firewall-cmd --permanent --reload
</pre>
<h4>5) 下载并部署密钥</h4>
<pre class="chroma">wget -O /etc/krb5.keytab http://classroom.example.com/pub/keytabs/server0.keytab
</pre>
<h4>6) 开启加密nfs服务</h4>
<pre class="chroma">systemctl <span class="nb">enable</span> nfs-secure-server.service
systemctl start nfs-secure-server.serivce
</pre>
<h3>第11题：挂载一个NFS共享(client)</h3>

<h4>1) 创建挂载目录</h4>
<pre class="chroma">mkdir /mnt/nfsmount
mkdir /mnt/nfssecure
</pre>
<h4>2) 配置/etc/fstab完成开机自动挂载</h4>
<pre class="chroma">vi /etc/fstab
*****************************************
<span class="c1">#增加</span>
server0.example.com:/public /mnt/nfsmount nfs defaults <span class="m">0</span> <span class="m">0</span>
server0.example.com:/protected /mnt/nfssecure nfs defaults,sec<span class="o">=</span>krb5p <span class="m">0</span> <span class="m">0</span>
*****************************************
</pre>
<h4>3) 完成krb5认证挂载的key下载</h4>
<pre class="chroma">wget -O /etc/krb5.keytab http://classroom.example.com/pub/keytabs/desktop0.keytab
systemctl <span class="nb">enable</span> nfs-secure
systemctl start nfs-secure
</pre>
<h4>4) 挂载</h4>
<pre class="chroma">mount -a
df -h
</pre>
<h4>5) 验证krb5认证是否生效</h4>
<pre class="chroma">ssh ldapuser0@localhost            <span class="c1"># password是：kerberos</span>
<span class="c1"># cd进/mnt/nfssecure/project做个文件检查下是否可读写</span>
</pre>
<h3>第12题：实现一个web服务器(server)</h3>

<h4>1) 安装apache包</h4>
<pre class="chroma">yum install -y httpd
systemctl <span class="nb">enable</span> httpd
systemctl start httpd
</pre>
<h4>2) 配置防火墙</h4>
<pre class="chroma">firewall-cmd --permanent --add-service<span class="o">=</span>http
firewall-cmd --reload
</pre>
<h4>3) 创建vhost配置文件</h4>
<pre class="chroma">vi /etc/httpd/conf.d/vhost-server0.conf
*******************************************
&lt;VirtualHost *:80&gt;
ServerName server0.example.com
DocumentRoot <span class="s2">&#34;/var/www/html&#34;</span>
CustomLog <span class="s2">&#34;logs/server0_vhost_log&#34;</span> combined
&lt;Directory <span class="s2">&#34;/var/www/html&#34;</span>&gt;
&lt;RequireAll&gt;
Require all granted
Require not host .my133t.org
&lt;/RequireAll&gt;
&lt;/Directory&gt;
&lt;/VirtualHost&gt;
*******************************************
</pre>
<h4>4) 下载首页</h4>
<pre class="chroma">wget -O /var/www/html/index.html http://classroom.example.com/materials/station.html
</pre>
<h4>5) 重启服务&amp;查看端口状态</h4>
<pre class="chroma">systemctl restart httpd
lsof -i:80 -n
</pre>
<h3>第13题：配置安全web服务(server)</h3>

<h4>1) 安装ssl包</h4>
<pre class="chroma">yum install -y mod_ssl
</pre>
<h4>2) 添加防火墙规则</h4>
<pre class="chroma">firewall-cmd --permanent --add-service<span class="o">=</span>https
firewall-cmd --reload
</pre>
<h4>3) 下载网站证书</h4>
<pre class="chroma">wget -O /etc/pki/tls/certs/server0.crt http://classroom.example.com/pub/tls/certs/server0.crt
wget -O /etc/pki/tls/private/server0.key http://classroom.example.com/pub/tls/private/server0.key
wget -O /etc/pki/tls/certs/example-ca.crt http://classroom.example.com/pub/example-ca.crt
</pre>
<h4>4) 修改ssl配置文件</h4>
<pre class="chroma">vi /etc/httpd/conf.d/ssl.conf
*************************************************
<span class="c1">#在&lt;VirtualHost _default_:443&gt;块下添加</span>
ServerName server0.example.com
DocumentRoot <span class="s2">&#34;/var/www/html&#34;</span>
 
<span class="c1">#修改如下证书路径</span>
SSLCertificateFile /etc/pki/tls/certs/server0.crt
SSLCertificateKeyFile /etc/pki/tls/private/server0.key
SSLCACertificateFile /etc/pki/tls/certs/example-ca.crt
 
<span class="c1">#添加访问控制</span>
&lt;/Directory <span class="s2">&#34;/var/www/html&#34;</span>&gt;
&lt;RequireAll&gt;
Require all granted
Require not host .my133t.org
&lt;/RequireAll&gt;
&lt;/Directory&gt;
*************************************************
systemctl restart httpd
</pre>
<h4>5) 用浏览器访问http和https版本的域名检查</h4>

<h3>第14题：配置虚拟主机(server)</h3>

<h4>1) 服务安装启动\防火墙规则（其实前面已经做过）</h4>
<pre class="chroma">yum install -y httpd
systemctl <span class="nb">enable</span> httpd
systemctl start httpd
firewall-cmd --permanent --add-service<span class="o">=</span>http
firewall-cmd --reload
</pre>
<h4>2) 添加虚拟主机配置文件</h4>
<pre class="chroma">vi /etc/httpd/conf.d/vhost-www0.conf
*******************************************
&lt;VirtualHost *:80&gt;
ServerName www0.example.com
DocumentRoot <span class="s2">&#34;/var/www/virtual&#34;</span>
CustomLog <span class="s2">&#34;logs/www0_virtual_log&#34;</span> combined
&lt;Directory <span class="s2">&#34;/var/www/virtual&#34;</span>&gt;
Require all granted
&lt;/Directory&gt;
&lt;/VirtualHost&gt;
*******************************************
</pre>
<h4>3) 创建虚拟机目录&amp;下载主页文件</h4>
<pre class="chroma">mkdir -p /var/www/virtual
wget -O /var/www/virtual/index.html http://classroom.example.com/materials/www.html
</pre>
<h4>4) selinux上下文设置</h4>
<pre class="chroma">semanage fcontext -a -t httpd_sys_content_t <span class="s1">&#39;/var/www/virtual(/.*)?&#39;</span>
restorecon -vFR /var/www/virtual
</pre>
<h4>5) 创建用户</h4>
<pre class="chroma">useradd floyd
setfacl -m user:floyd:rwx /var/www/virtual
</pre>
<h3>第15题：配置web内容的访问(server)</h3>

<h4>1) 创建虚拟主机目录</h4>
<pre class="chroma">mkdir /var/www/virtual/private
wget -O /var/www/virtual/private/index.html http://classroom.example.com/materials/private.html
</pre>
<h4>2) 修改配置文件</h4>
<pre class="chroma">vi /etc/httpd/conf.d/vhost-www0.conf
*********************************************
<span class="c1">#在&lt;VirtualHost&gt;中添加如下代码</span>
&lt;Directory <span class="s2">&#34;/var/www/html/private&#34;</span>&gt;
Require all denied
Require <span class="nb">local</span>
&lt;/Directory&gt;
*********************************************
</pre>
<h4>3) 重启服务</h4>
<pre class="chroma">systemctl restart httpd
</pre>
<h4>4) 测试结果</h4>
<pre class="chroma">curl http://www0.example.com/private
</pre>
<h3>第16题：实现动态web内容(server)&ndash;新版题库无此题</h3>

<h4>1) 安装apache动态模块</h4>
<pre class="chroma">yum install -y mod-wsgi
</pre>
<h4>2) 创建目录及下载文件</h4>
<pre class="chroma">mkdir /var/www/webapp
wget -O /var/www/webapp/webinfo.wsgi http://classroom.example.com/materials/webinfo.wsgi
semanage fcontext -a -t httpd_sys_content_t <span class="s1">&#39;/var/www/webapp(/.*)?&#39;</span>
restorecon -vFR /var/www/webapp
</pre>
<h4>3) 添加配置文件</h4>
<pre class="chroma">vi /etc/httpd/conf.d/vhost-webapp0.conf
********************************************
Listen <span class="m">8908</span>
&lt;VirtualHost *:8908&gt;
ServerName webapp0.example.com
DocumentRoot <span class="s2">&#34;/var/www/webapp&#34;</span>
CustomLog <span class="s2">&#34;logs/webapp0_vhost_log&#34;</span> combined
&lt;Directory <span class="s2">&#34;/var/www/webapp&#34;</span>&gt;
Require all granted
&lt;/Directory&gt;
 
WSGIScriptAlias / /var/www/webapp/webinfo.wsgi
 
&lt;/VirtualHost&gt;
********************************************
</pre>
<h4>4) 配置selinux和firewall</h4>
<pre class="chroma">semanage port -a -t http_port_t -p tcp <span class="m">8908</span>
firewall-cmd --permanent --add-rich-rule <span class="s1">&#39;rule family=ipv4 source address=172.25.0.0/24 port port=8908 protocol=tcp accept&#39;</span>
firewall-cmd --reload
</pre>
<h4>5) 重启服务</h4>
<pre class="chroma">systemctl restart httpd
</pre>
<h4>6) 检查效果</h4>
<pre class="chroma">curl http://webapp0.example.com:8908
</pre>
<h3>第17题：创建一个脚本(server)</h3>

<h4>1) 编写脚本</h4>
<pre class="chroma">vi /root/foo.sh
**********************************
<span class="c1">#!/bin/bash</span>
 
<span class="k">case</span> <span class="nv">$1</span> in
redhat<span class="o">)</span>
<span class="nb">echo</span> <span class="s2">&#34;fedora&#34;</span>
<span class="p">;</span><span class="p">;</span>
fedora<span class="o">)</span>
<span class="nb">echo</span> <span class="s2">&#34;redhat&#34;</span>
<span class="p">;</span><span class="p">;</span>
*<span class="o">)</span>
<span class="nb">echo</span> <span class="s2">&#34;/root/foo.sh redhat|fedora&#34;</span>
<span class="p">;</span><span class="p">;</span>
<span class="k">esac</span>
**********************************
</pre>
<h4>2) 配置执行权限</h4>
<pre class="chroma">chmod <span class="m">755</span> /root/foo.sh
</pre>
<h3>第18题：创建一个添加用户的脚本(server)</h3>

<h4>1) 编写脚本</h4>
<pre class="chroma">vi /root/batchusers
***********************************************
<span class="c1">#!/bin/bash</span>
 
<span class="k">if</span> <span class="o">[</span> <span class="nv">$-</span>eq <span class="m">1</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
         <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
          <span class="k">while</span> <span class="nb">read</span> username<span class="p">;</span><span class="k">do</span>
                 useradd -s /bin/false <span class="nv">$username</span> <span class="p">&amp;</span>&gt; /dev/null
             <span class="k">done</span> &lt; <span class="nv">$1</span>
      <span class="k">else</span>
                <span class="nb">echo</span> <span class="s2">&#34;Input file not found&#34;</span>
             <span class="nb">exit</span> <span class="m">1</span>
     <span class="k">fi</span>
<span class="k">else</span>
      <span class="nb">echo</span> <span class="s2">&#34;Usage: /root/batchusers userfile&#34;</span>
       <span class="nb">exit</span> <span class="m">2</span>
<span class="k">fi</span>
***********************************************
</pre>
<h4>2) 配置执行权限</h4>
<pre class="chroma">chmod <span class="m">755</span> /root/batchusers
</pre>
<h4>3) 下载userlist</h4>
<pre class="chroma">wget -O /root/userlist http://classroom.example.com/materials/userlist
</pre>
<h4>4) 执行脚本</h4>
<pre class="chroma">/root/batchusers /root/userlist
</pre>
<h4>5) 检查结果</h4>
<pre class="chroma">tail -4 /etc/passwd
</pre>
<h3>第19题：配置ISCSI服务端(server)</h3>

<h4>1) 安装targetcli</h4>
<pre class="chroma">yum install targetcli -y
systemctl <span class="nb">enable</span> target
systemctl start target
</pre>
<h4>2) firewall添加端口</h4>
<pre class="chroma">firewall-cmd --permanent --add-port<span class="o">=</span>3260/tcp
firewall-cmd --reload
</pre>
<h4>3) 新建硬盘分区</h4>
<pre class="chroma">lsblk
fdisk /dev/sdb
Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: n
Partition type:
   p   primary <span class="o">(</span><span class="m">0</span> primary, <span class="m">0</span> extended, <span class="m">4</span> free<span class="o">)</span>
   e   extended
Select <span class="o">(</span>default p<span class="o">)</span>: 
Using default response p
Partition number <span class="o">(</span>1-4, default 1<span class="o">)</span>: 
First sector <span class="o">(</span>2048-20971519, default 2048<span class="o">)</span>: 
Using default value <span class="m">2048</span>
Last sector, +sectors or +size<span class="o">{</span>K,M,G<span class="o">}</span> <span class="o">(</span>2048-20971519, default 20971519<span class="o">)</span>: +4G
Partition <span class="m">1</span> of <span class="nb">type</span> Linux and of size <span class="m">4</span> GiB is <span class="nb">set</span>

Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: t
Selected partition <span class="m">1</span>
Hex code <span class="o">(</span><span class="nb">type</span> L to list all codes<span class="o">)</span>: 8e
Changed <span class="nb">type</span> of partition <span class="s1">&#39;Linux&#39;</span> to <span class="s1">&#39;Linux LVM&#39;</span>
 
Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: w
The partition table has been altered!

Calling ioctl<span class="o">(</span><span class="o">)</span> to re-read partition table.
Syncing disks.
 
 
<span class="c1">#把分区创建为物理卷</span>
pvcreate /dev/sdb1
 
<span class="c1">#创建虚拟卷组</span>
vgcreate iSCSI_vg /dev/sdb1
 
<span class="c1">#创建虚拟卷</span>
lvcreate -n iscsi_store -L 3G iSCSI_vg
 
<span class="c1">#查看结果</span>
lvs
</pre>
<h4>4) 创建ISCSI服务</h4>
<pre class="chroma">targetcli
&gt; <span class="nb">cd</span> /scsi
&gt; create iqn.2014-11.com.example:server0
&gt; iqn.2014-11.com.example:server0/tgp1/portals create 172.25.0.11 <span class="m">3260</span>
 
<span class="c1">#绑定一个后端卷</span>
&gt; <span class="nb">cd</span> /
&gt; backstores/block create <span class="nv">name</span><span class="o">=</span>server0.iscsi_store <span class="nv">dev</span><span class="o">=</span>/dev/iSCSI_vg/iscsi_store
&gt; iscsi/iqn.2014-11.com.example:server0/tpg1/luns create /backstores/block/server0.iscsi_store
 
<span class="c1">#做访问控制</span>
&gt; iscsi/iqn.2014-11.com.example:server0/tpg1/acls create iqn.2014-11.com.example:desktop0
<span class="c1">#关闭密码验证的访问控制</span>
&gt; iscsi/iqn.2014-11.com.example:server0/tpg1/ <span class="nb">set</span> attribute <span class="nv">authentication</span><span class="o">=</span><span class="m">0</span>
<span class="c1">#使上面的访问控制生效</span>
&gt; iscsi/iqn.2014-11.com.example:server0/tpg1/ <span class="nb">set</span> attribute <span class="nv">generate_node_acls</span><span class="o">=</span><span class="m">0</span>
 
<span class="c1">#保存并退出</span>
&gt; saveconfig
&gt; <span class="nb">exit</span>
 
<span class="c1">#### 5) 查看设置结果</span>
targetcli
&gt; ls
</pre>
<h3>第20题：配置ISCSI的客户端(client)</h3>

<h4>1) 安装iscsi客户端</h4>
<pre class="chroma">yum install iscsi-initiator-utils -y
</pre>
<h4>2) 配置iscsi文件中的客户端名称</h4>
<pre class="chroma">vi /etc/iscsi/initiatorname.iscsi
************************************
<span class="nv">InitiatorName</span><span class="o">=</span>iqn.2014-11.com.example:desktop0
************************************
</pre>
<h4>3) 启动客户端服务</h4>
<pre class="chroma">systemctl <span class="nb">enable</span> iscsi
systemctl start iscsi
</pre>
<h4>4) 配置自动发现服务端并连接</h4>
<pre class="chroma">iscsiadm -m discovery -t st -p 172.25.0.11
iscsiadm -m node -l
</pre>
<h4>5) 创建iscsi硬盘分区并格式化</h4>
<pre class="chroma">lsblk                                       <span class="c1"># 会发现多了一个硬盘</span>
fdisk /dev/sdc
n
p
<span class="m">1</span>
+2100M
w
 
<span class="c1">#格式化</span>
mkfs.ext4 /dev/sdc1
 
<span class="c1">#### 6) 挂载iscsi硬盘分区</span>
mkdir /mnt/data
 
<span class="c1">#获取分区UUID</span>
blkid /dev/sdc1
 
vi /etc/fstab
**************************************************
UUID_HERE /mnt/data ext4 defaults,_netdev <span class="m">0</span> <span class="m">0</span>
**************************************************
 
mount -a
 
<span class="c1">#检查挂载结果</span>
df -h
</pre>
<h3>第21题：安装MariaDB数据库(server)</h3>

<h4>1) 安装数据库包</h4>
<pre class="chroma">yum groupinstall mariadb mariadb-client -y
</pre>
<h4>2) 启动mariadb服务</h4>
<pre class="chroma">systemctl <span class="nb">enable</span> mariadb
systemctl start mariadb
</pre>
<h4>3) 数据库初始化</h4>
<pre class="chroma">mysql_secure_installation
密码是空
y
输入新密码
再次输入新密码
y
y
y
y
</pre>
<h4>4) 下载数据库备份文件</h4>
<pre class="chroma">wget -O /root/mariadb.dump http://classroom.example.com/content/courses/rhce/rhel7.0/materials/mariadb/mariadb.dump
</pre>
<h4>5) 创建数据库</h4>
<pre class="chroma">mysql -uroot -p
&gt; create database legacy<span class="p">;</span>
&gt; use legacy<span class="p">;</span>
&gt; <span class="nb">source</span> /root/mariadb.dump
&gt; show tables<span class="p">;</span>show databases<span class="p">;</span>
</pre>
<h4>6) 创建用户并分配权限</h4>
<pre class="chroma">&gt; grant <span class="k">select</span> on legacy.* to mary@<span class="s1">&#39;localhost&#39;</span> identified by <span class="s1">&#39;mary_password&#39;</span><span class="p">;</span>
&gt; grant <span class="k">select</span>,insert,update,delete on legacy.* to legacy@<span class="s1">&#39;localhost&#39;</span> identified by <span class="s1">&#39;legacy_password&#39;</span><span class="p">;</span>
&gt; grant <span class="k">select</span> on legacy.* to report@<span class="s1">&#39;localhost&#39;</span> identified by <span class="s1">&#39;report_password&#39;</span><span class="p">;</span>
</pre>
<h3>第22题：数据查询填空(server)</h3>
<pre class="chroma">mysql -uroot -p
&gt; use legacy<span class="p">;</span>
&gt; desc product<span class="p">;</span>
&gt;  <span class="k">select</span> id from product where <span class="nv">name</span><span class="o">=</span><span class="s1">&#39;RT-AC68U&#39;</span><span class="p">;</span>
&gt; <span class="k">select</span> count<span class="o">(</span>product.id<span class="o">)</span> from category,product where category.name<span class="o">=</span><span class="s1">&#39;Servers&#39;</span> and category.id<span class="o">=</span>product.id_category<span class="p">;</span>
</pre>
    </div>

  </div>
</body>

<footer>
    <div class="container">
        <div class="row footer-links">
            <div class="col-lg-2 col-sm-2">
                <h3>友情链接</h3>
                <ul>
                    <li><a href="">友链位招租</a></li>
                    <li><a href="">友链位招租</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>没想好</h3>
                <ul>
                    <li><a href="">我爸没想好</a></li>
                    <li><a href="">我哥说我爸没想好</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>Hooray</h3>
                <ul>
                    <li><a href="">Hooray</a></li>
                    <li><a href="">What are we Hooray For?</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>前面的footer太浪了</h3>
                <ul>
                    <li><a href="">就是就是</a></li>
                    <li><a href="">偷偷的表示羡慕</a></li>
                </ul>
            </div>
            <div class="col-lg-4 col-sm-4">
                <h3>网站信息</h3>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <div class="fine-print">
                    <p>网战由以下技术支撑</p>
                    <ul>
                        <li>Markdown Processor: <a href="https://github.com/russross/blackfriday/tree/v2">Blackfriday V2</a></li>
                        <li>Renderer Engine: <a href="https://github.com/Depado/bfchroma/">bfchroma</a></li>
                        <li>Syntax Highlighter: <a href="https://github.com/alecthomas/chroma">Chroma</a></li>
                        <li>Coding Language: <a href="https://go.dev/">Golang</a></li>
                        <li>Others: Markdown, HTML, CSS</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>

</html>