<!DOCTYPE html>
<html lang="zh-cmn">

<head>
    <title>XTY Blog | Linux Ops Docs | SRE | DEVOPS</title>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <link rel="stylesheet" href="/static/css/chroma.css">
    <link rel="stylesheet" href="/static/css/main.css">
</head>

<div class="blog-title">
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<div>
					<a class="main-title" href="/">XTY的小站</a>
                </div>
                <div>
                    <a class="small-title" href="/">记录技术笔记和技术博客</a>
                </div>
			</div>
		</div>
	</div>
</div>

<body>
  <div class="container">

    <div class="col-lg-4 col-lg-offset-1 col-md-4 col-md-offset-1 col-sm-4 col-sm-offset-1">
	  <div id="sidebar">

		<h3>最新文章</h3>
          <ul>

            <li>
              <a href="/service/tomcat/tomcat_1.1.0_config_args_sessionCookieName.html">tomcat 1.0.0 什么是tomcat</a>
            </li>
            <li>
              <a href="/linux/shell/shell_1.2_read.html">SHELL: 1.2 read</a>
            </li>
            <li>
              <a href="/cryptography/basic/openssl_1.3.1_usage.html">openssl 1.3.1 SSL DEBUG: s_client</a>
            </li>
            <li>
              <a href="/linux/advance/network_theory-TCP-IP-note.html">网络: 理论 - TCP/IP详解读书笔记</a>
            </li>
            <li>
              <a href="/service/apache/1.0.1_apache_work_mode.html">apache: 理论 - 工作模式</a>
            </li>
          </ul>

		<h3>文章分类</h3>
		  <ul>

            <li>
              <a href="/android/index.html">android</a>
            </li>
            <li>
              <a href="/bigdata/index.html">bigdata</a>
            </li>
            <li>
              <a href="/blockchain/index.html">blockchain</a>
            </li>
            <li>
              <a href="/blog/index.html">blog</a>
            </li>
            <li>
              <a href="/cloud/index.html">cloud</a>
            </li>
            <li>
              <a href="/cryptography/index.html">cryptography</a>
            </li>
            <li>
              <a href="/database/index.html">database</a>
            </li>
            <li>
              <a href="/devops/index.html">devops</a>
            </li>
            <li>
              <a href="/go/index.html">go</a>
            </li>
            <li>
              <a href="/ios/index.html">ios</a>
            </li>
            <li>
              <a href="/java/index.html">java</a>
            </li>
            <li>
              <a href="/linux/index.html">linux</a>
            </li>
            <li>
              <a href="/python/index.html">python</a>
            </li>
            <li>
              <a href="/service/index.html">service</a>
              <ul>
                <li>
                  <a href="/service/apache/index.html">apache</a>
                  <ul>
                    <li><a href="/service/apache/1.0.0_apache_installation.html">apache: 安装 - 脚本示例</a></li>
                    <li><a href="/service/apache/1.0.1_apache_work_mode.html">apache: 理论 - 工作模式</a></li>
                    <li><a href="/service/apache/1.1.0_apache_config_basic.html">apache: 配置 - 基本配置</a></li>
                    <li><a href="/service/apache/1.1.0_b_apache_config_rewrite.html">apache: 配置 - rewrite</a></li>
                    <li><a href="/service/apache/1.1.0_c_apache_config_access_limit.html">apache: 配置 - htpasswd</a></li>
                    <li><a href="/service/apache/1.1.0_d_apache_config_anti_leech_file_gate.html">apache: 配置 - 防盗链</a></li>
                    <li><a href="/service/apache/1.1.0_e_apache_config_old_2.2_directory_access_limit.html">apache: 配置 - 目录文件限制（2.2旧版本）</a></li>
                    <li><a href="/service/apache/1.1.0_f_apache_config_log_and_cache.html">apache: 配置 - 日志/缓存</a></li>
                    <li><a href="/service/apache/1.1.1_apache_config_parse_php.html">apache: 配置 - PHP解析</a></li>
                    <li><a href="/service/apache/1.1.2_apache_config_security.html">apache: 配置 - 安全</a></li>
                    <li><a href="/service/apache/1.1.3_apache_config_make_servername_and_serveralias_an_ip.html">apache: 配置 - 可以把ServerName和ServerAlias配置为IP吗？</a></li>
                    <li><a href="/service/apache/1.2.0_apache_status_check.html">apache: 管理 - 状态查看</a></li>
                    <li><a href="/service/apache/1.3.0_apache_iptables_selinux.html">apache: 管理 - iptables和selinux</a></li>
                    <li><a href="/service/apache/1.4.0_apache_practice_discuz.html">apache: 实践 - discuz</a></li>
                  </ul>
                </li>
                <li>
                  <a href="/service/dnsmasq/index.html">dnsmasq</a>
                </li>
                <li>
                  <a href="/service/fluentd/index.html">fluentd</a>
                </li>
                <li>
                  <a href="/service/ftp/index.html">ftp</a>
                </li>
                <li>
                  <a href="/service/haproxy/index.html">haproxy</a>
                </li>
                <li>
                  <a href="/service/jira/index.html">jira</a>
                </li>
                <li>
                  <a href="/service/jitsi-meet/index.html">jitsi-meet</a>
                </li>
                <li>
                  <a href="/service/jumpserver/index.html">jumpserver</a>
                </li>
                <li>
                  <a href="/service/kafka/index.html">kafka</a>
                </li>
                <li>
                  <a href="/service/keepalived/index.html">keepalived</a>
                </li>
                <li>
                  <a href="/service/nginx/index.html">nginx</a>
                </li>
                <li>
                  <a href="/service/php/index.html">php</a>
                </li>
                <li>
                  <a href="/service/proxy/index.html">proxy</a>
                </li>
                <li>
                  <a href="/service/squid/index.html">squid</a>
                </li>
                <li>
                  <a href="/service/svn/index.html">svn</a>
                </li>
                <li>
                  <a href="/service/tomcat/index.html">tomcat</a>
                </li>
                <li>
                  <a href="/service/vpn/index.html">vpn</a>
                </li>
                <li>
                  <a href="/service/zabbix/index.html">zabbix</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="/virtualization/index.html">virtualization</a>
            </li>
            <li>
              <a href="/web/index.html">web</a>
            </li>
          </ul>

      </div>
    </div>

    <div class="col-lg-7 col-md-7 col-sm-7">
      <h2>apache: 配置 - 目录文件限制（2.2旧版本）</h2>
      <div>
        <hr style="border: 0; border-top: 1px dashed #a2a9b6">
      </div>
      <div class="postDate">
        <p>09 Jan 2015</p>
      </div>
      <div>
        <hr style="border: 0; border-bottom: 1px dashed #a2a9b6">
      </div>
<h3>0. apache2.2版本的目录文件控制</h3>

<p>模块：<code>mod_access_compat</code><br />
简介：<br />
在新版本中被<code>mod_authz_host</code>替代<br />
可用在<code>&lt;Directory&gt;</code><code>&lt;Files&gt;</code><code>&lt;Location&gt;</code>和<code>.htaccess</code>文件中<br />
可控制hostname,IP或者request的变量<br />
用Allow和Deny来控制客户端的访问权限<br />
用Order来设置默认访问状态，和设定Allow、Deny的生效顺序</p>

<p>用法简介：</p>

<ul>
<li><p>Allow用法汇总：</p>

<ul>
<li>domain-name(可以用不完整domain-name)
<code>
Allow from example.org
Allow from .net example.edu
</code></li>
<li>IP地址(可以用不完整ip)
<code>
Allow from 10.1.2.3
Allow from 192.168.1.104 192.168.1.205
Allow from 10.1
Allow from 10 172.20 192.168.2
</code></li>
<li>IP网段
<code>
Allow from 10.1.0.0/255.255.0.0
Allow from 10.1.0.0/16
</code></li>
<li>变量
<code>
Allow from env=env-variable
Allow from env=!env-variable
</code>
举例 - 只有user-agent是knockknock/2.0的才可以访问<br />
<code>
SetEnvIf User-Agent ^KnockKnock/2\.0 let_me_in
&lt;Directory &quot;/docroot&quot;&gt;
Order Deny,Allow
Deny from all
Allow from env=let_me_in
&lt;/Directory&gt;
</code></li>
</ul></li>

<li><p>Deny用法汇总：
同Allow，只是关键词变成了Deny</p></li>

<li><p>Order用法汇总：</p>

<ul>
<li><p><code>Order Allow,Deny</code></p></li>

<li><p>a. 判断所有Allow条件，匹配任意一条则通过，若无匹配，则拒绝；</p></li>

<li><p>b. 判断所有Deny条件，匹配任意一条则拒绝；</p></li>

<li><p>c. 以上均无匹配的，默认拒绝。</p></li>

<li><p><code>Order Deny,Allow</code></p></li>

<li><p>a. 判断所有Deny条件，匹配任意一条则拒绝，除非它同时匹配Allow规则</p></li>

<li><p>b. 判断所有Allow条件，匹配任意一条则通过；</p></li>

<li><p>c. 以上均无匹配的，默认通过</p></li>
</ul></li>
</ul>

<p>举例说明</p>
<pre class="chroma">*******************************************************
Order Deny，Allow
Allow from example.org
Deny from foo.example.org
*******************************************************
a. foo.example.org匹配Deny，但同时满足Allow，通过
b. example.org匹配Allow，通过
c. 其他所有不匹配*.example.org的，通过
综述，所有条件的域名均可通过以上规则

<span class="c1">## 实例</span>
<span class="c1">## 只允许本机访问特定目录下的php文件</span>
*******************************************************
&lt;Directory /path/to/dir&gt;
    php_admin_flag engine off
    &lt;Filesmatch <span class="s2">&#34;</span><span class="s2">(.*)php</span>$<span class="s2">&#34;</span>&gt;
            Order deny,allow
            Deny from all
            Allow from 127.0.0.1
    &lt;/Filesmatch&gt;
&lt;/Directory&gt;
*******************************************************
</pre>
<hr />

<h3>1. apache2.4版本的目录文件控制</h3>

<h4>1) Require Directive</h4>

<p>作用：检查是否用户被authorization provider授权<br />
模块：<code>mod_authz_core</code><br />
语法：<code>Require [not] entity-name [entity-name] ...</code><br />
container： <code>&lt;RequireAll&gt;</code>, <code>&lt;RequireAny&gt;</code> and <code>&lt;RequireNone&gt;</code></p>

<p>authorization provider汇总：</p>

<blockquote>
<ol>
<li><code>Require all granted</code><br />
Access is allowed unconditionally</li>
<li><code>Require all denied</code><br />
Access is denied unconditionally</li>
<li><code>Require env env-var [env-var] ...</code><br />
Access is allowed only if one of the given environment variables is set</li>
<li><code>Require method http-method [http-method] ...</code><br />
Access is allowed only for the given HTTP methods</li>
<li><code>Require expr expression</code><br />
Access is allowed if expression evaluates to true
示例：<br />
<code>Require expr &quot;%{TIME_HOUR} -ge 9 &amp;&amp; %{TIME_HOUR} -le 17&quot;</code></li>
</ol>

<p>由<code>mod_authz_user</code>,<code>mod_authz_host</code>,<code>mod_authz_groupfile</code>提供的用法</p>

<ol>
<li><code>Require user userid [userid] ...</code><br />
Only the named users can access the resource.</li>
<li><code>Require group group-name [group-name] ...</code><br />
Only users in the named groups can access the resource.</li>
<li><code>Require valid-user</code><br />
All valid users can access the resource.</li>
<li><code>Require ip 10 172.20 192.168.2</code><br />
Clients in the specified IP address ranges can access the resource.</li>
</ol>
</blockquote>

<p>用法举例：</p>
<pre class="chroma"><span class="c1">## env：允许KnockKnoick/2.0开头的User-Agent访问</span>
SetEnvIf User-Agent ^KnockKnock/2<span class="se">\.</span><span class="m">0</span> let_me_in
&lt;Directory <span class="s2">&#34;/docroot&#34;</span>&gt;
    Require env let_me_in
&lt;/Directory&gt;

<span class="c1">## expr：</span>
Require expr <span class="s2">&#34;%{TIME_HOUR} -ge 9 &amp;&amp; %{TIME_HOUR} -le 17&#34;</span>

<span class="c1"># 以下两种同义</span>
&lt;RequireAll&gt;
    Require expr <span class="s2">&#34;!(%{QUERY_STRING} =~ /secret/)&#34;</span>
    Require expr <span class="s2">&#34;%{REQUEST_URI} in { &#39;/example.cgi&#39;, &#39;/other.cgi&#39; }&#34;</span>
&lt;/RequireAll&gt;

Require expr <span class="s2">&#34;!(%{QUERY_STRING} =~ /secret/) &amp;&amp; %{REQUEST_URI} in { &#39;/example.cgi&#39;, &#39;/other.cgi&#39; }&#34;</span>
</pre>
<h4>2) container</h4>

<ul>
<li>RequireAll
&gt;生效条件：不能有失败的规则，至少有一条成功的规则
中性结果：没有成功的也没有失败的规则，返回中性结果
失败条件：除以上两种以外的情况</li>
<li>RequireAny
&gt;若同时出现多条Require，却没有container，默认就是RequireAny
生效条件：至少一条成功的规则
中性结果：没有成功的也没有失败的规则，返回中性结果
失败条件：除以上两种以外的情况</li>
<li>RequireNone
&gt;生效条件：不能有成功的规则
失败条件：有一条及以上成功的规则
中性结果：其他所有情况</li>
</ul>

    </div>

  </div>
</body>

<footer>
    <div class="container">
        <div class="row footer-links">
            <div class="col-lg-2 col-sm-2">
                <h3>友情链接</h3>
                <ul>
                    <li><a href="">友链位招租</a></li>
                    <li><a href="">友链位招租</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>没想好</h3>
                <ul>
                    <li><a href="">我爸没想好</a></li>
                    <li><a href="">我哥说我爸没想好</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>Hooray</h3>
                <ul>
                    <li><a href="">Hooray</a></li>
                    <li><a href="">What are we Hooray For?</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>前面的footer太浪了</h3>
                <ul>
                    <li><a href="">就是就是</a></li>
                    <li><a href="">偷偷的表示羡慕</a></li>
                </ul>
            </div>
            <div class="col-lg-4 col-sm-4">
                <h3>网站信息</h3>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <div class="fine-print">
                    <p>网战由以下技术支撑</p>
                    <ul>
                        <li>Markdown Processor: <a href="https://github.com/russross/blackfriday/tree/v2">Blackfriday V2</a></li>
                        <li>Renderer Engine: <a href="https://github.com/Depado/bfchroma/">bfchroma</a></li>
                        <li>Syntax Highlighter: <a href="https://github.com/alecthomas/chroma">Chroma</a></li>
                        <li>Coding Language: <a href="https://go.dev/">Golang</a></li>
                        <li>Others: Markdown, HTML, CSS</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>

</html>