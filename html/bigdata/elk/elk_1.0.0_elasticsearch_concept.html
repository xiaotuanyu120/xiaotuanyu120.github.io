<!DOCTYPE html>
<html lang="zh-cmn">

<head>
    <title>XTY Blog | Linux Ops Docs | SRE | DEVOPS</title>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <link rel="stylesheet" href="/static/css/chroma.css">
    <link rel="stylesheet" href="/static/css/main.css">
</head>

<div class="blog-title">
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<div>
					<a class="main-title" href="/">XTY的小站</a>
                </div>
                <div>
                    <a class="small-title" href="/">记录技术笔记和技术博客</a>
                </div>
			</div>
		</div>
	</div>
</div>

<body>
  <div class="container">

    <div class="col-lg-4 col-lg-offset-1 col-md-4 col-md-offset-1 col-sm-4 col-sm-offset-1">
	  <div id="sidebar">

		<h3>最新文章</h3>
          <ul>

            <li>
              <a href="/java/jvm/jdk_3.1.0_config_java.security.html">JDK 配置 - java security</a>
            </li>
            <li>
              <a href="/linux/advance/dns_01_dns_problem_analysis.html">DNS解析问题排查实践</a>
            </li>
            <li>
              <a href="/linux/advance/dns_00_how_dns_work_in_linux.html">Linux中的DNS解析是如何工作的</a>
            </li>
            <li>
              <a href="/service/dnsmasq/dnsmasq_01.01_introduction_and_basic.html">dnsmasq基础知识</a>
            </li>
            <li>
              <a href="/linux/advance/memory_01_how_memory_work_in_linux.html">linux中的内存是如何工作的？</a>
            </li>
          </ul>

		<h3>文章分类</h3>
		  <ul>

            <li>
              <a href="/android/index.html">android</a>
            </li>
            <li>
              <a href="/bigdata/index.html">bigdata</a>
              <ul>
                <li>
                  <a href="/bigdata/cloudera/index.html">cloudera</a>
                </li>
                <li>
                  <a href="/bigdata/elk/index.html">elk</a>
                  <ul>
                    <li><a href="/bigdata/elk/elasticsearch_1.1.0_docker_installation.html">elasticsearch 1.1.0: docker installation</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.0_elasticsearch_concept.html">elk 1.0.0: elasticsearch concept</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.1_elasticsearch_removal_of_mapping_types.html">elk 1.0.1: elasticsearch removal of mapping types</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.2_after_installation_explore_your_cluster.html">elk 1.10.2: explore you cluster</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.3_after_installation_modify_your_data.html">elk 1.0.3: modify your data</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.4_after_installation_explore_your_data.html">elk 1.0.4: explore your data</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.5_elasticsearch_index_templates.html">elk 1.0.5: elasticsearch index templates</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.6_elasticsearch_mapping.html">elk 1.0.6: elasticsearch mapping</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.7.a_elasticsearch_cluster_api_cluster_setting.html">elk 1.0.7.a: elasticsearch cluster api - cluster setting</a></li>
                    <li><a href="/bigdata/elk/elk_1.0.8.a_elasticsearch_modules_snapshot_and_restore.html">elk 1.0.8.a: elasticsearch modules - snapshot and restore</a></li>
                    <li><a href="/bigdata/elk/elk_1.1.0_production_installation.html">elk 1.1.0: production installation</a></li>
                    <li><a href="/bigdata/elk/elk_1.1.1_production_installation_add_xpack.html">elk 1.1.1: production installation add xpack</a></li>
                    <li><a href="/bigdata/elk/elk_1.2.0_elasticsearch_upgrade_from_6.2.4_to_6.4.2.html">elk 1.2.0: elasticsearch upgrade from 6.2.4 to 6.4.2</a></li>
                    <li><a href="/bigdata/elk/elk_2.1.0_conf_logstash_index_name_date.html">elk 2.1.0 logstash config index name with current date</a></li>
                    <li><a href="/bigdata/elk/elk_2.2.0_conf_filebeat_logstash_kafka.html">elk 2.2.0 config kafka with filebeat and logstash</a></li>
                    <li><a href="/bigdata/elk/elk_2.2.1_error_filebeat_kafka_waiting_for_space.html">elk 2.2.1 config kafka with filebeat and logstash</a></li>
                    <li><a href="/bigdata/elk/elk_3.1.0_logstash_plugin_grok.html">elk 3.1.0 logstash plugin grok</a></li>
                    <li><a href="/bigdata/elk/elk_3.2.0_logstash_plugin_geoip_and_kibana_visualize.html">elk 3.2.0 logstash plugin geoip and kibana visualize</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li>
              <a href="/blockchain/index.html">blockchain</a>
            </li>
            <li>
              <a href="/blog/index.html">blog</a>
            </li>
            <li>
              <a href="/cloud/index.html">cloud</a>
            </li>
            <li>
              <a href="/cryptography/index.html">cryptography</a>
            </li>
            <li>
              <a href="/database/index.html">database</a>
            </li>
            <li>
              <a href="/devops/index.html">devops</a>
            </li>
            <li>
              <a href="/go/index.html">go</a>
            </li>
            <li>
              <a href="/ios/index.html">ios</a>
            </li>
            <li>
              <a href="/java/index.html">java</a>
            </li>
            <li>
              <a href="/linux/index.html">linux</a>
            </li>
            <li>
              <a href="/python/index.html">python</a>
            </li>
            <li>
              <a href="/service/index.html">service</a>
            </li>
            <li>
              <a href="/virtualization/index.html">virtualization</a>
            </li>
            <li>
              <a href="/web/index.html">web</a>
            </li>
          </ul>

      </div>
    </div>

    <div class="col-lg-7 col-md-7 col-sm-7">
      <h2>elk 1.0.0: elasticsearch concept</h2>
      <div>
        <hr style="border: 0; border-top: 1px dashed #a2a9b6">
      </div>
      <div class="postDate">
        <p>11 Oct 2018</p>
      </div>
      <div>
        <hr style="border: 0; border-bottom: 1px dashed #a2a9b6">
      </div>
<h3>Basic Concept</h3>

<p>elasticsearch中有一些核心概念，理解它们会简化学习elasticsearch的进程。</p>

<h3>Near Realtime(NRT)</h3>

<p>elasticsearch是一个接近实时查询的平台，这意味着在你index一个document到它可以被搜索之间有一个微小的延迟(通常是1s)。</p>

<h3>Cluster</h3>

<p>一个集群是一个或者多个服务器的集合，它(们共同)保管了所有的数据，并提供了跨越所有节点的联合索引和搜索功能。一个集群会拥有一个独一无二的集群名称，默认是elasticsearch。这个名称很重要，因为如果节点设置为按照名称加入集群，节点只有正确设定名称才会是集群的一部分。<br />
确保不要在不同的环境中重用相同的群集名称，否则可能会导致节点加入错误的群集。<br />
注意，如果一个集群只包含一个节点是正常情况。此外，你可以设定多个集群，每个集群拥有唯一的集群名称。</p>

<h3>Node</h3>

<p>节点是作为群集一部分的单个服务器，存储数据并参与群集的索引和搜索功能。就像群集一样，节点由名称标识，默认情况下，该名称是在启动时分配给节点的随机通用唯一标识符（UUID）。如果不希望使用默认的名称，可以手动配置。从管理角度来看，此名称非常重要，可以在其中识别网络中哪些服务器与Elasticsearch集群中的哪些节点相对应。<br />
可以将节点配置为按群集名称加入特定群集。 默认情况下，每个节点都设置为加入名为elasticsearch的群集，这意味着如果您在网络上启动了许多节点并且 - 假设他们可以相互发现 - 他们将自动形成并加入名为elasticsearch的单个群集。<br />
在单个群集中，您可以拥有任意数量的节点。此外，如果您的网络上当前没有其他Elasticsearch节点正在运行，则默认情况下，启动单个节点将形成名为elasticsearch的新单节点集群。</p>

<h3>Index</h3>

<p>Index是具有某些类似特征的Document集合。例如，您可以拥有客户数据的Index，产品目录的另一个Index以及订单数据的另一个Index。Index由名称标识（必须全部小写），此名称用于在对其中的文档执行索引、搜索、更新和删除操作时引用索引。<br />
在一个集群中，你可以定义任意数量的index。</p>

<h3>Type(6.0.0 Deprecated)</h3>

<p>Type曾是index的逻辑类别或分区，允许你在同一index中储存不同类型的document，例如一个type是用户信息，另外一个type是发布的博客。不再可能在索引中创建多个type，并且将在更高版本中删除type的整个概念。 废弃原因可以查看： <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/removal-of-types.html">Removal of mapping types</a></p>

<h3>Document</h3>

<p>document是可以被索引的一个基本信息单元。例如，你可以为单个客户提供document、为单个产品提供document、为单个订单提供document。document使用JSON（JavaScript Object Notation）表示，它是一种普遍存在的互联网数据交换格式。<br />
在同一个index/type中，你可以存储任意数量的document。值得注意的是，尽管document物理上是储存在index中，但是实际上是需要被索引或分配到index中的一个type中。</p>

<h3>Shards &amp; Replicas</h3>

<p>Index可能存储大量可能超过单个节点的硬件限制的数据。例如，占用1TB磁盘空间的十亿个documents的单个index可能不适合只使用单个节点的磁盘，或者可能在单个节点的磁盘去执行搜索请求时太慢。<br />
为了解决这个问题，Elasticsearch提供了将index细分为多个称为shards的功能。创建索引时，只需定义所需的shard数即可。每个shard本身都是一个功能齐全且独立的“index”，可以托管在集群中的任何节点上。</p>

<p>sharding之所以重要，是因为以下两个原因：</p>

<ul>
<li>它允许你水平拆分或缩放内容量</li>
<li>它允许您跨shard（可能在多个节点上）分布和并行化操作，从而提高性能/吞吐量</li>
</ul>

<p>shard的分布方式以及如何将其文档聚合回搜索请求的机制完全由Elasticsearch管理，对用户而言是透明的。</p>

<p>在可以随时发生故障的网络/云环境中，强烈建议使用故障转移机制，这非常有用，可以预防shard/节点以某种方式脱机或因任何原因消失。为此，Elasticsearch允许您将索index的shard的一个或多个副本制作成所谓的replica shards或简称replicas。</p>

<p>replication之所以重要，是因为以下两个原因：</p>

<ul>
<li>在shard或node发生错误时提供高可用性。因此，特别需要注意的是，replica shard不可以和原始的shard在同一个节点上。</li>
<li>它允许您扩展搜索量/吞吐量，因为可以在所有副本上并行执行搜索。</li>
</ul>

<p>总而言之，每个index可以拆分为多个shard。 index也可以复制为零（表示没有replica）或更多次。 复制后，每个index都将具有primary shard和replica shard（主分片的副本）。<br />
可以在创建索引时为每个索引定义分片和副本的数量，可以在任意时间动态的调整replicas的数量。你可以使用_shrink和_split API更改现有index的shard数量，但这不是一项简单的任务，预先计划正确数量的shard是最佳方法。<br />
默认情况下，Elasticsearch中的每个索引都分配了5个primary shard和1个replica，这意味着如果群集中至少有两个节点，则索引将包含5个primary shard和另外5个replica shard（1个完整副本），总计为 每个index 10个shard。</p>

<blockquote>
<p>每个Elasticsearch分片都是Lucene索引。 单个Lucene索引中的documents都有一个最大数量。 从<a href="https://issues.apache.org/jira/browse/LUCENE-5843">LUCENE-5843</a>之后，限制为2,147,483,519（= Integer.MAX_VALUE - 128）个文件。 您可以使用<code>_cat/shards</code> API查看shard数量。</p>
</blockquote>

    </div>

  </div>
</body>

<footer>
    <div class="container">
        <div class="row footer-links">
            <div class="col-lg-2 col-sm-2">
                <h3>友情链接</h3>
                <ul>
                    <li><a href="">友链位招租</a></li>
                    <li><a href="">友链位招租</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>没想好</h3>
                <ul>
                    <li><a href="">我爸没想好</a></li>
                    <li><a href="">我哥说我爸没想好</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>Hooray</h3>
                <ul>
                    <li><a href="">Hooray</a></li>
                    <li><a href="">What are we Hooray For?</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>前面的footer太浪了</h3>
                <ul>
                    <li><a href="">就是就是</a></li>
                    <li><a href="">偷偷的表示羡慕</a></li>
                </ul>
            </div>
            <div class="col-lg-4 col-sm-4">
                <h3>网站信息</h3>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <div class="fine-print">
                    <p>网战由以下技术支撑</p>
                    <ul>
                        <li>Markdown Processor: <a href="https://github.com/russross/blackfriday/tree/v2">Blackfriday V2</a></li>
                        <li>Renderer Engine: <a href="https://github.com/Depado/bfchroma/">bfchroma</a></li>
                        <li>Syntax Highlighter: <a href="https://github.com/alecthomas/chroma">Chroma</a></li>
                        <li>Coding Language: <a href="https://go.dev/">Golang</a></li>
                        <li>Others: Markdown, HTML, CSS</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>

</html>