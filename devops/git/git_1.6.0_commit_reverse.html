<!DOCTYPE html>
<html lang="zh-cmn">

<head>
    <title>XTY Blog | Linux Ops Docs | SRE | DEVOPS</title>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <link rel="stylesheet" href="/static/css/chroma.css">
    <link rel="stylesheet" href="/static/css/main.css">
</head>

<div class="blog-title">
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<div>
					<a class="main-title" href="/">XTY的小站</a>
                </div>
                <div>
                    <a class="small-title" href="/">记录技术笔记和技术博客</a>
                </div>
			</div>
		</div>
	</div>
</div>

<body>
  <div class="container">

    <div class="col-lg-4 col-lg-offset-1 col-md-4 col-md-offset-1 col-sm-4 col-sm-offset-1">
	  <div id="sidebar">

		<h3>最新文章</h3>
          <ul>

            <li>
              <a href="/service/tomcat/tomcat_1.1.0_config_args_sessionCookieName.html">tomcat 1.0.0 什么是tomcat</a>
            </li>
            <li>
              <a href="/linux/shell/shell_1.2_read.html">SHELL: 1.2 read</a>
            </li>
            <li>
              <a href="/cryptography/basic/openssl_1.3.1_usage.html">openssl 1.3.1 SSL DEBUG: s_client</a>
            </li>
            <li>
              <a href="/linux/advance/network_theory-TCP-IP-note.html">网络: 理论 - TCP/IP详解读书笔记</a>
            </li>
            <li>
              <a href="/service/apache/1.0.1_apache_work_mode.html">apache: 理论 - 工作模式</a>
            </li>
          </ul>

		<h3>文章分类</h3>
		  <ul>

            <li>
              <a href="/android/index.html">android</a>
            </li>
            <li>
              <a href="/bigdata/index.html">bigdata</a>
            </li>
            <li>
              <a href="/blockchain/index.html">blockchain</a>
            </li>
            <li>
              <a href="/blog/index.html">blog</a>
            </li>
            <li>
              <a href="/cloud/index.html">cloud</a>
            </li>
            <li>
              <a href="/cryptography/index.html">cryptography</a>
            </li>
            <li>
              <a href="/database/index.html">database</a>
            </li>
            <li>
              <a href="/devops/index.html">devops</a>
              <ul>
                <li>
                  <a href="/devops/ansible/index.html">ansible</a>
                </li>
                <li>
                  <a href="/devops/arthas/index.html">arthas</a>
                </li>
                <li>
                  <a href="/devops/git/index.html">git</a>
                  <ul>
                    <li><a href="/devops/git/git_1.1.0_install.html">git: 1.1.0 安装</a></li>
                    <li><a href="/devops/git/git_1.2.0_branch.html">git: 1.2.0 分支</a></li>
                    <li><a href="/devops/git/git_1.2.1_branch_pr.html">git: 1.2.1 分支-Pull Request</a></li>
                    <li><a href="/devops/git/git_1.2.2_tag.html">git: 1.2.2 git tag</a></li>
                    <li><a href="/devops/git/git_1.3.0_gitignore.html">git: 1.3.0 忽略文件-“.gitignore”</a></li>
                    <li><a href="/devops/git/git_1.4.0_delete_file.html">git: 1.4.0 删除文件</a></li>
                    <li><a href="/devops/git/git_1.5.0_mv.html">git: 1.5.0 mv error(case sensitive of linux)</a></li>
                    <li><a href="/devops/git/git_1.6.0_commit_reverse.html">git: 1.6.0 撤销操作</a></li>
                    <li><a href="/devops/git/git_1.7.0_push_403.html">git: 1.7.0 push返回403</a></li>
                    <li><a href="/devops/git/git_1.8.0_add_link_file.html">git: 1.8.0 添加链接文件</a></li>
                    <li><a href="/devops/git/git_1.9.0_combine_commits_using_rebase.html">git: 1.9.0 使用rebase合并多个commit</a></li>
                    <li><a href="/devops/git/giterror_1.1.0_curl_18.html">git error: 1.1.0 curl 18 error</a></li>
                    <li><a href="/devops/git/github_tutorial.html">github: 入门引导</a></li>
                    <li><a href="/devops/git/gitlab_1.1.0_install.html">gitlab: 1.1.0 安装(centos6)</a></li>
                    <li><a href="/devops/git/gitlab_1.2.0_config_external_port.html">gitlab: 1.2.0 配置gitlab访问端口</a></li>
                    <li><a href="/devops/git/gitlab_1.3.0_backup_restore_update.html">gitlab: 1.3.0 gitlab备份,恢复及升级</a></li>
                    <li><a href="/devops/git/gitlab_ci_1.1.0_gitlab_runner_installation.html">gitlab-ci: 1.1.0 gitlab-runner安装(docker)</a></li>
                    <li><a href="/devops/git/gitlab_ci_1.1.1_gitlab_runner_configuration.html">gitlab-ci: 1.1.1 gitlab-runner(docker)配置</a></li>
                    <li><a href="/devops/git/gitlab_ci_1.2.0_gitlab_ci_yml_basic.html">gitlab-ci: 1.2.0 .gitlab-ci.yml 基础</a></li>
                    <li><a href="/devops/git/gitlab_ci_1.2.1_gitlab_ci_yml_cache_artifact.html">gitlab-ci: 1.2.1 .gitlab-ci.yml - cache and artifact</a></li>
                    <li><a href="/devops/git/gitlab_ci_1.2.2_gitlab_ci_yml_example.html">gitlab-ci: 1.2.2 .gitlab-ci.yml 复杂示例 - 包含get gitlab tag message</a></li>
                    <li><a href="/devops/git/gitlab_ci_1.3.0_build_docker_image.html">gitlab-ci: 1.3.0 编译docker镜像</a></li>
                    <li><a href="/devops/git/gitrepo_1.1.0_create_local_repo.html">git仓库: 1.1.0 centos6搭建git本地服务器</a></li>
                    <li><a href="/devops/git/gitrepo_1.2.0_anonymous_access.html">git仓库: 1.2.0 本地服务器开启匿名访问</a></li>
                    <li><a href="/devops/git/gitrepo_1.3.0_web.html">git仓库: 1.3.0 本地服务器web界面</a></li>
                  </ul>
                </li>
                <li>
                  <a href="/devops/jenkins/index.html">jenkins</a>
                </li>
                <li>
                  <a href="/devops/mattermost/index.html">mattermost</a>
                </li>
                <li>
                  <a href="/devops/sonarqube/index.html">sonarqube</a>
                </li>
                <li>
                  <a href="/devops/vagrant/index.html">vagrant</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="/go/index.html">go</a>
            </li>
            <li>
              <a href="/ios/index.html">ios</a>
            </li>
            <li>
              <a href="/java/index.html">java</a>
            </li>
            <li>
              <a href="/linux/index.html">linux</a>
            </li>
            <li>
              <a href="/python/index.html">python</a>
            </li>
            <li>
              <a href="/service/index.html">service</a>
            </li>
            <li>
              <a href="/virtualization/index.html">virtualization</a>
            </li>
            <li>
              <a href="/web/index.html">web</a>
            </li>
          </ul>

      </div>
    </div>

    <div class="col-lg-7 col-md-7 col-sm-7">
      <h2>git: 1.6.0 撤销操作</h2>
      <div>
        <hr style="border: 0; border-top: 1px dashed #a2a9b6">
      </div>
      <div class="postDate">
        <p>09 Dec 2016</p>
      </div>
      <div>
        <hr style="border: 0; border-bottom: 1px dashed #a2a9b6">
      </div>
<h3>1. 修改最后一次提交</h3>

<p>当你提交之后，可能会发现刚才的提交忘记了几个文件或者提交信息不合理，这时候可以使用&ndash;amend命令<br />
<code>git commit --amend</code>会将stage区域的文件合并到上次的提交中，最终我们会只有一次提交(第二次提交会替代第一次提交)</p>
<pre class="chroma"><span class="c1"># 做出部分修改，并提交分支</span>
<span class="nb">echo</span> <span class="s2">&#34;version 2&#34;</span> &gt; version.txt
touch newfile
git add version.txt
git commit -m <span class="s2">&#34;change version info&#34;</span>

<span class="c1"># 此时突然发现忘记添加新创建的newfile</span>
git add newfile
git commit --amend
<span class="c1">#这里会让你重新编辑提交信息</span>
</pre>
<hr />

<h3>2. reset撤回操作(适用于私人仓库)</h3>

<p>在提交层面上，reset将分支的末端指向另外一个提交，这可以用来移除当前分支的某些提交，让我们拥有重新来过的机会。为了理解这个，我们需要牢记git中的一个基本知识(文件区域)<br />
工作目录 &ndash;&gt; stage区域 &ndash;&gt; commit区域</p>

<p>reset其实用三个参数，来对应的对于上面的区域做撤回操作</p>

<ul>
<li>&ndash;soft - 只会改变commit区域，stage区域和工作目录都不会被改变</li>
<li>&ndash;mixed - 默认选项。stage区域和你指定的提交同步，但工作目录不受影响</li>
<li>&ndash;hard - stage区域和工作目录都同步到你指定的提交</li>
</ul>

<h4>1) commit之前，撤销stage区域的文件</h4>

<p>我们会将工作区的文件修改后，添加到stage区域，但有时候我们希望撤销stage区域的全部文件或者部分文件</p>
<pre class="chroma"><span class="c1"># 对当前分支两个文件做出修改</span>
git mv newfile oldfile
<span class="nb">echo</span> <span class="s2">&#34;version 3&#34;</span> &gt; version.txt
<span class="c1"># stage所有修改过的文件</span>
git add *
<span class="c1"># 查看当前状态</span>
git status
位于分支 master
要提交的变更：
  （使用 <span class="s2">&#34;git reset HEAD &lt;文件&gt;...&#34;</span> 以取消暂存）

	重命名：   newfile -&gt; oldfile
	修改：     version.txt

<span class="c1"># 此时我们发现有些文件需要撤回</span>
git reset HEAD
重置后取消暂存的变更：
D	newfile
M	version.txt

<span class="c1"># 之所以我们会发现恢复后的状态是删除了newfile，而新的oldfile并没有被add，是因为git mv本身就是两步操作的合集，mv + git add</span>
git status
位于分支 master
尚未暂存以备提交的变更：
  （使用 <span class="s2">&#34;git add/rm &lt;文件&gt;...&#34;</span> 更新要提交的内容）
  （使用 <span class="s2">&#34;git checkout -- &lt;文件&gt;...&#34;</span> 丢弃工作区的改动）

	删除：     newfile
	修改：     version.txt

未跟踪的文件:
  （使用 <span class="s2">&#34;git add &lt;文件&gt;...&#34;</span> 以包含要提交的内容）

	oldfile
</pre>
<blockquote>
<p>若只希望撤回某个文件，可以使用git reset HEAD <file></p>
</blockquote>

<h4>2）&ndash;mixed，撤回最后一次commit和stage区域的文件</h4>
<pre class="chroma"><span class="c1"># 添加oldfile</span>
git add oldfile
<span class="c1"># 提交&#34;add oldfile&#34;</span>
git commit -a -m <span class="s2">&#34;add oldfile&#34;</span>
<span class="c1"># 查看最后一次提交信息</span>
git log<span class="p">|</span>head -5
commit 9f78a8c7a48363479347a88e8b7be79e97902641
Author: zhao &lt;example@outlook.com&gt;
Date:   Thu Apr <span class="m">6</span> 21:45:17 <span class="m">2017</span> +0800

    add oldfile

<span class="c1"># 此时希望回退到上一次提交，则执行下面的命令</span>
git reset HEAD~1
<span class="c1"># 查看最后一次提交信息，发现已经回退到了上一次的提交</span>
git log<span class="p">|</span>head -5
commit b35b3b2d1a0600a9d09ad9dfa6f9dbfc8df46bf7
Author: zhao &lt;example@outlook.com&gt;
Date:   Thu Apr <span class="m">6</span> 21:07:36 <span class="m">2017</span> +0800

    update newfile
<span class="c1"># 由于默认reset是--mixed，会改变stage区域和指定的commit</span>
<span class="c1">#所以上次提交到stage区域的oldfile也被撤回到了工作区域</span>
git status
位于分支 master
未跟踪的文件:
  （使用 <span class="s2">&#34;git add &lt;文件&gt;...&#34;</span> 以包含要提交的内容）

	oldfile

提交为空，但是存在尚未跟踪的文件（使用 <span class="s2">&#34;git add&#34;</span> 建立跟踪）
</pre>
<h4>3) &ndash;hard，撤回最后一次commit和stage区域的文件，同时撤回工作目录的所有修改</h4>
<pre class="chroma"><span class="c1"># 修改newfile文件名称及修改version.txt内容</span>
git mv newfile file
<span class="nb">echo</span> <span class="s2">&#34;version hard&#34;</span> &gt; version.txt
git add *
git commit -m <span class="s2">&#34;rename newfile and change version&#34;</span>
<span class="o">[</span>master 9699d6a<span class="o">]</span> rename newfile and change version
 <span class="m">2</span> files changed, <span class="m">1</span> insertion<span class="o">(</span>+<span class="o">)</span>, <span class="m">1</span> deletion<span class="o">(</span>-<span class="o">)</span>
 rename <span class="nv">newfile</span> <span class="o">=</span>&gt; file <span class="o">(</span>100%<span class="o">)</span>

<span class="c1"># 使用--hard回退到上一次提交的完整状态</span>
git reset --hard HEAD~1
HEAD 现在位于 b35b3b2 update newfile
<span class="c1"># stage区域的操作被撤回，包括工作目录的全部改动</span>
git status
位于分支 master
无文件要提交，干净的工作区

ls
newfile  version.txt
</pre>
<blockquote>
<p>可以看到reset可以更改commit信息，这样的操作不可用在公共仓库上，适用于私人仓库或还没有push的私有分支，因为我们不希望已经被团队接纳的操作再被私自撤回或修改，这样不利于团队配合</p>
</blockquote>

<h4>4) reset撤回到指定的commit</h4>

<p>工作中遇到这样一个问题，按照<code>reset --hard HEAD~1</code>回退，结果有一个是merge的commit，每一个merge的commit都有两个额外的commit标记(commit_num_1 commit_num_2)，此时reset撤回，如果不指定的话，直接默认是回退到commit_num_1上，如果我们想回退到第二个commit号上，就只能用<code>revert -m commit_num_2</code>。 然而revert是向前增加commit，reset是向后撤销commit。 我当时的需求是后面需要继续reset，也可以用一个简单的用法<code>reset --hard commit_num</code>, 直接指向更后面的comit号也可以。</p>

<hr />

<h3>3. revert撤回操作(适用于公共仓库)</h3>

<p>reset会回退commit信息，来达到撤回操作的目的，但是那样不适用于多人维护的公共仓库，因为有可能别人的工作是基于你撤销的那个commit，有没有一种办法，不会修改历史的commit也能达到撤销操作的目的呢？那就是revert，revert撤销一个提交的同时会创建一个新的提交，新的提交不会改变提交历史，但是通过这个新的提交，我们撤销了之前提交的一些操作。</p>
<pre class="chroma"><span class="c1"># 目前我们有4次commit(每次commit都是修改version.txt的内容)</span>
git log
commit ca6d40697dbf88d3bec1c98b5c7d933eadacb272
Author: zhao &lt;example@outlook.com&gt;
Date:   Tue Apr <span class="m">11</span> 08:56:01 <span class="m">2017</span> +0000

    commit <span class="m">4</span>

commit 5844493eadc4797fef97f698782524c98bc388c5
Author: zhao &lt;example@outlook.com&gt;
Date:   Tue Apr <span class="m">11</span> 08:55:55 <span class="m">2017</span> +0000

    commit <span class="m">3</span>

commit 557de5cb4f48df417b6d8ce88651904b94b0fe9c
Author: zhao &lt;example@outlook.com&gt;
Date:   Tue Apr <span class="m">11</span> 08:54:58 <span class="m">2017</span> +0000

    commit <span class="m">2</span>

commit b2c685b1aa00b772bee38cfca0368ffc2c17cbb0
Author: zhao &lt;example@outlook.com&gt;
Date:   Tue Apr <span class="m">11</span> 08:54:49 <span class="m">2017</span> +0000

    commit <span class="m">1</span>


<span class="c1"># 目前我们有两个文件</span>
ls
oldfile  version.txt

<span class="c1"># 我们希望从version4回退到version3</span>
git revert HEAD
Finished one revert.
<span class="o">[</span>master c0b7328<span class="o">]</span> Revert <span class="s2">&#34;commit 4&#34;</span>
 <span class="m">1</span> files changed, <span class="m">1</span> insertions<span class="o">(</span>+<span class="o">)</span>, <span class="m">1</span> deletions<span class="o">(</span>-<span class="o">)</span>
<span class="c1">#这里我们有一次新的机会重新填写commit信息，会创建一个新的comit，但是其实是撤销了最后一次commit的操作</span>

<span class="c1"># 查看git commit信息</span>
git log
commit c0b732867d3aa39ab76bb6b7d883b454225c2a1a
Author: zhao &lt;example@outlook.com&gt;
Date:   Tue Apr <span class="m">11</span> 08:56:34 <span class="m">2017</span> +0000

    Revert <span class="s2">&#34;commit 4&#34;</span>

    This reverts commit ca6d40697dbf88d3bec1c98b5c7d933eadacb272.

commit ca6d40697dbf88d3bec1c98b5c7d933eadacb272
Author: zhao &lt;example@outlook.com&gt;
Date:   Tue Apr <span class="m">11</span> 08:56:01 <span class="m">2017</span> +0000

    commit <span class="m">4</span>

commit 5844493eadc4797fef97f698782524c98bc388c5
Author: zhao &lt;example@outlook.com&gt;
Date:   Tue Apr <span class="m">11</span> 08:55:55 <span class="m">2017</span> +0000

    commit <span class="m">3</span>

commit 557de5cb4f48df417b6d8ce88651904b94b0fe9c
Author: zhao &lt;example@outlook.com&gt;
Date:   Tue Apr <span class="m">11</span> 08:54:58 <span class="m">2017</span> +0000

    commit <span class="m">2</span>

commit b2c685b1aa00b772bee38cfca0368ffc2c17cbb0
Author: zhao &lt;example@outlook.com&gt;
Date:   Tue Apr <span class="m">11</span> 08:54:49 <span class="m">2017</span> +0000

    commit <span class="m">1</span>
</pre>
<blockquote>
<p>结果我们经过revert撤销操作，并没有修改以前的commit历史，这种操作适合公共仓库</p>

<p>如果希望撤销多个commit，可使用<code>git revert -m commit_num</code>来操作</p>
</blockquote>

    </div>

  </div>
</body>

<footer>
    <div class="container">
        <div class="row footer-links">
            <div class="col-lg-2 col-sm-2">
                <h3>友情链接</h3>
                <ul>
                    <li><a href="">友链位招租</a></li>
                    <li><a href="">友链位招租</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>没想好</h3>
                <ul>
                    <li><a href="">我爸没想好</a></li>
                    <li><a href="">我哥说我爸没想好</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>Hooray</h3>
                <ul>
                    <li><a href="">Hooray</a></li>
                    <li><a href="">What are we Hooray For?</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>前面的footer太浪了</h3>
                <ul>
                    <li><a href="">就是就是</a></li>
                    <li><a href="">偷偷的表示羡慕</a></li>
                </ul>
            </div>
            <div class="col-lg-4 col-sm-4">
                <h3>网站信息</h3>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <div class="fine-print">
                    <p>网战由以下技术支撑</p>
                    <ul>
                        <li>Markdown Processor: <a href="https://github.com/russross/blackfriday/tree/v2">Blackfriday V2</a></li>
                        <li>Renderer Engine: <a href="https://github.com/Depado/bfchroma/">bfchroma</a></li>
                        <li>Syntax Highlighter: <a href="https://github.com/alecthomas/chroma">Chroma</a></li>
                        <li>Coding Language: <a href="https://go.dev/">Golang</a></li>
                        <li>Others: Markdown, HTML, CSS</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>

</html>