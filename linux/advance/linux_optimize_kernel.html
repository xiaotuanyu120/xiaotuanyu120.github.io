<!DOCTYPE html>
<html lang="zh-cmn">

<head>
    <title>XTY Blog | Linux Ops Docs | SRE | DEVOPS</title>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <link rel="stylesheet" href="/static/css/chroma.css">
    <link rel="stylesheet" href="/static/css/main.css">
</head>

<div class="blog-title">
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<div>
					<a class="main-title" href="/">XTY的小站</a>
                </div>
                <div>
                    <a class="small-title" href="/">记录技术笔记和技术博客</a>
                </div>
			</div>
		</div>
	</div>
</div>

<body>
  <div class="container">

    <div class="col-lg-4 col-lg-offset-1 col-md-4 col-md-offset-1 col-sm-4 col-sm-offset-1">
	  <div id="sidebar">

		<h3>最新文章</h3>
          <ul>

            <li>
              <a href="/linux/advance/fd_01_file_descriptor_brief_introduction.html">fd: 文件描述符简明介绍</a>
            </li>
            <li>
              <a href="/service/haproxy/haproxy_01_config_log.html">haproxy: 配置和日志</a>
            </li>
            <li>
              <a href="/service/haproxy/haproxy_00_start_up_with_docker_compose.html">haproxy: 使用docker-compose启动haproxy</a>
            </li>
            <li>
              <a href="/service/apache/1.1.3_apache_config_make_servername_and_serveralias_an_ip.html">apache 配置: 可以把ServerName和ServerAlias配置为IP吗？</a>
            </li>
            <li>
              <a href="/linux/advance/performance_01_io_limit.html">performance: 限制进程的IO消耗</a>
            </li>
          </ul>

		<h3>文章分类</h3>
		  <ul>

            <li>
              <a href="/android/index.html">android</a>
            </li>
            <li>
              <a href="/bigdata/index.html">bigdata</a>
            </li>
            <li>
              <a href="/blockchain/index.html">blockchain</a>
            </li>
            <li>
              <a href="/blog/index.html">blog</a>
            </li>
            <li>
              <a href="/cloud/index.html">cloud</a>
            </li>
            <li>
              <a href="/cryptography/index.html">cryptography</a>
            </li>
            <li>
              <a href="/database/index.html">database</a>
            </li>
            <li>
              <a href="/devops/index.html">devops</a>
            </li>
            <li>
              <a href="/go/index.html">go</a>
            </li>
            <li>
              <a href="/ios/index.html">ios</a>
            </li>
            <li>
              <a href="/java/index.html">java</a>
            </li>
            <li>
              <a href="/linux/index.html">linux</a>
              <ul>
                <li>
                  <a href="/linux/advance/index.html">advance</a>
                  <ul>
                    <li><a href="/linux/advance/CENTOS_多网卡+多网关配置.html">CENTOS: 多网卡+多网关配置</a></li>
                    <li><a href="/linux/advance/auditd_1.0.0_basic.html">auditd: linux 审计</a></li>
                    <li><a href="/linux/advance/bash_1.1.0_.bashrc_vs_.bash_profile.html">bash 1.1.0 .bashrc vs .bash_profile</a></li>
                    <li><a href="/linux/advance/centos6_booted_services_optimize.html">centos6 开机服务优化</a></li>
                    <li><a href="/linux/advance/curl_1.1.0_post_usage.html">curl 1.1.0 POST usage</a></li>
                    <li><a href="/linux/advance/discuz管理中心登录的时候闪退.html">discuz管理中心登录的时候闪退</a></li>
                    <li><a href="/linux/advance/disk_1.0.1_xfs_undelete_recovery.html">disk: 1.0.1 xfs 硬盘数据恢复</a></li>
                    <li><a href="/linux/advance/dns_00_how_dns_work_in_linux.html">Linux中的DNS解析是如何工作的</a></li>
                    <li><a href="/linux/advance/dns_01_dns_problem_analysis.html">DNS解析问题排查实践</a></li>
                    <li><a href="/linux/advance/fd_01_file_descriptor_brief_introduction.html">fd: 文件描述符简明介绍</a></li>
                    <li><a href="/linux/advance/ffmpeg_1.1.0_convert_h265_to_h264.html">ffmpeg: 1.1.0 转换h265为h264</a></li>
                    <li><a href="/linux/advance/firewall_ipset_basic.html">firewall: ipset使用教程</a></li>
                    <li><a href="/linux/advance/firewall_ipset_bitmap_ip_mac.html">firewall: ipset-bitmap:ip,mac</a></li>
                    <li><a href="/linux/advance/firewall_iptables_filter_by_country.html">firewall: iptables防国家或地区流量</a></li>
                    <li><a href="/linux/advance/firewall_iptables_install_centos7.html">firewall: Centos7安装iptables</a></li>
                    <li><a href="/linux/advance/glibc_1.1.0_centos6.5_upgrade_2.14.html">glibc 1.1.0 centos6升级到2.14</a></li>
                    <li><a href="/linux/advance/iconv_convert_encode_from_win_2_linux.html">linux: tranfer file from windows to linux, using iconv</a></li>
                    <li><a href="/linux/advance/kernel_1.1.0_tcp_time_wait.html">内核调优: 1.1.0 优化TCP来解决TIME_WAIT状态过多</a></li>
                    <li><a href="/linux/advance/kernel_1.1.1_nf_conntrack_table.html">内核调优: 1.1.1 优化nf_conntrack表来解决tcp包被drop的问题</a></li>
                    <li><a href="/linux/advance/kernel_1.1.2_tcp_time_wait_len_vs_fin_timeout.html">内核调优: 1.1.2 TIMEWAIT销毁时间是否可以通过tcp_fin_timeout优化？</a></li>
                    <li><a href="/linux/advance/kernel_1.1.3_listen_backlog.html">内核参数: 1.1.3 内核listen()中的参数 backlog</a></li>
                    <li><a href="/linux/advance/kernel_1.1.4_cgroup.html">linux内核: 1.1.4 cgroup</a></li>
                    <li><a href="/linux/advance/kernel_1.1.5_enable_module.html">linux内核: 1.1.5 启用模块</a></li>
                    <li><a href="/linux/advance/kernel_1.2.0_system_load_or_cpu_load.html">linux内核: 1.2.0 system load or cpu load</a></li>
                    <li><a href="/linux/advance/linux_optimize_kernel.html">linux: 优化 - 内核</a></li>
                    <li><a href="/linux/advance/linux_optimize_ulimit.html">linux: 系统资源限制 - 文件打开数 - ulimit、systemd</a></li>
                    <li><a href="/linux/advance/linux_optimize_ulimit_error.html">linux: 普通用户无法修改ulimit</a></li>
                    <li><a href="/linux/advance/linux_optimize_ulimit_ext_file_describer.html">linux: ulimit优化 - 扩展文件句柄vs文件描述符</a></li>
                    <li><a href="/linux/advance/linux登录后显示_bash-4.1.html">linux登录后显示_bash-4.1</a></li>
                    <li><a href="/linux/advance/linux知识盲点（数组与拷贝）.html">linux知识盲点（数组与拷贝）</a></li>
                    <li><a href="/linux/advance/memory_01_how_memory_work_in_linux.html">linux中的内存是如何工作的？</a></li>
                    <li><a href="/linux/advance/memory_02_what_is_inside_meminfo.html">/proc/meminfo里面有什么？</a></li>
                    <li><a href="/linux/advance/network_Centos7_no_nic_device.html">network: Centos7 没有可用的网络设备</a></li>
                    <li><a href="/linux/advance/network_centos7-network_error.html">network: Centos7-网络服务错误</a></li>
                    <li><a href="/linux/advance/network_tcp_alive_time_check.html">network: tcp 连接存活时间查询方法</a></li>
                    <li><a href="/linux/advance/network_tcp_handshake.html">network: 理解TCP三次握手和四次挥手</a></li>
                    <li><a href="/linux/advance/network_tcp_keepalive.html">network: tcp keepalive (include versus with http keepalive)</a></li>
                    <li><a href="/linux/advance/network_tcp_tcp_queue.html">network: tcp queue(转载)</a></li>
                    <li><a href="/linux/advance/network_vmware_clone_Centos6.html">network: vmware克隆Centos6后的网络设置</a></li>
                    <li><a href="/linux/advance/nginx_log_combined.html">nginx: log_format combined?</a></li>
                    <li><a href="/linux/advance/openssh_1.0.1_sshd_key_auth_error.html">openssh 1.0.1 sshd 密钥认证错误原因排查</a></li>
                    <li><a href="/linux/advance/oper_1.0_file_and_user_process.html">日常管理: 1.0 查看文件与用户和进程的关联</a></li>
                    <li><a href="/linux/advance/optimize_1.2.0_web.html">调优: 1.2.0 web服务器优化</a></li>
                    <li><a href="/linux/advance/performance_01_io_limit.html">performance: 限制进程的IO消耗</a></li>
                    <li><a href="/linux/advance/rsync_1.1.0_max_connections.html">rsync 1.1.0 error: max connections reached</a></li>
                    <li><a href="/linux/advance/rsync_1.2.0_chmod_chown.html">rsync 1.2.0 chown chmod</a></li>
                    <li><a href="/linux/advance/selinux_1.0.0_basic.html">selinux 1.0.0 basic</a></li>
                    <li><a href="/linux/advance/selinux_1.0.1_enable_selinux_from_disabled.html">selinux 1.0.1 enable selinux from disabled status</a></li>
                    <li><a href="/linux/advance/selinux_1.0.2_sshd_public_key_lable.html">selinux 1.0.2 lable sshd public key file</a></li>
                    <li><a href="/linux/advance/ssl_generate_key_cfssl.html">ssl: generate key by cfssl</a></li>
                    <li><a href="/linux/advance/sudo_1.1.0_SETENV_NOPASSWD.html">sudo 1.1.0 执行sudo时保持env变量</a></li>
                    <li><a href="/linux/advance/systemd_1.0.0_hook_start_and_stop.html">systemd 1.0.0 同时启动关停多个服务</a></li>
                    <li><a href="/linux/advance/systemd_1.1.0_debug_cmd.html">systemd 1.1.0 排查错误使用的命令</a></li>
                    <li><a href="/linux/advance/systemd_1.2.0_unit_file_load_sequence_and_manual.html">systemd 1.2.0 unit file load sequence and manual</a></li>
                    <li><a href="/linux/advance/systemd_1.3.0_start_pre_and_post.html">systemd 1.3.0 exec pre and post</a></li>
                    <li><a href="/linux/advance/systemd_2.1.0_watchdog_for_tomcat.html">systemd 2.1.0 watchdog of systemd for tomcat</a></li>
                    <li><a href="/linux/advance/systemd_2.1.1_watchdog_for_tomcat_error_of_nonroot_user.html">systemd 2.1.1 watchdog of systemd for tomcat continue: nonroot user problem</a></li>
                    <li><a href="/linux/advance/systeminfo_1.1.0_cpuinfo.html">系统信息：1.1.0 cpuinfo 超线程引起的争吵</a></li>
                    <li><a href="/linux/advance/tools_1.1.0_z_cd.html">工具: 1.1.0 切换目录-z武器</a></li>
                    <li><a href="/linux/advance/what_is_sni.html">what is SNI?</a></li>
                    <li><a href="/linux/advance/隐藏nginxtomcat版本号.html">隐藏nginx tomcat版本号</a></li>
                  </ul>
                </li>
                <li>
                  <a href="/linux/basic/index.html">basic</a>
                </li>
                <li>
                  <a href="/linux/desktop/index.html">desktop</a>
                </li>
                <li>
                  <a href="/linux/service/index.html">service</a>
                </li>
                <li>
                  <a href="/linux/shell/index.html">shell</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="/python/index.html">python</a>
            </li>
            <li>
              <a href="/service/index.html">service</a>
            </li>
            <li>
              <a href="/virtualization/index.html">virtualization</a>
            </li>
            <li>
              <a href="/web/index.html">web</a>
            </li>
          </ul>

      </div>
    </div>

    <div class="col-lg-7 col-md-7 col-sm-7">
      <h2>linux: 优化 - 内核</h2>
      <div>
        <hr style="border: 0; border-top: 1px dashed #a2a9b6">
      </div>
      <div class="postDate">
        <p>29 Jul 2016</p>
      </div>
      <div>
        <hr style="border: 0; border-bottom: 1px dashed #a2a9b6">
      </div>
<pre class="chroma">net.core.somaxconn <span class="o">=</span> <span class="m">655360</span>
<span class="c1"># 系统全局参数：每一个`listen()`socket的最大backlog上限</span>

net.core.netdev_max_backlog <span class="o">=</span> <span class="m">1048576</span>
<span class="c1"># 每个网络接口，允许后台排队队列数据包的最大数目</span>

net.ipv4.tcp_max_syn_backlog <span class="o">=</span> <span class="m">1048576</span>
<span class="c1"># 尚未收到客户端确认信息的连接请求的最大值</span>
</pre><p>5.4. 容量调节
本小节总结了内存、内核以及文件系统容量，与每一部分相关的参数以及调节这些参数所涉及的交换条件。
要在调节时临时设定这些值，请将所需值 echo 到 proc 文件系统中的适当文件中。例如：要将 overcommit_memory 临时设定为 1，请运行：</p>

<h1>echo 1 &gt; /proc/sys/vm/overcommit_memory</h1>

<p>注：到 proc 文件系统中该参数的路径要具体看此变更所影响的系统。
要永久设定这些值，则需要使用 sysctl 命令。有关详情请参考《部署指南》，网址为<a href="http://access.redhat.com/site/documentation/Red_Hat_Enterprise_Linux/。">http://access.redhat.com/site/documentation/Red_Hat_Enterprise_Linux/。</a>
与容量相关的内存可调参数
以下参数位于 proc 文件系统的 /proc/sys/vm/ 目录中。
overcommit_memory
规定决定是否接受超大内存请求的条件。这个参数有三个可能的值：
o 0 - 默认设置。内核执行启发式内存过量使用处理，方法是估算可用内存量，并拒绝明显无效的请求。遗憾的是因为内存是使用启发式而非准确算法计算进行部署，这个设置有时可能会造成系统中的可用内存超载。
o 1 - 内核执行无内存过量使用处理。使用这个设置会增大内存超载的可能性，但也可以增强大量使用内存任务的性能。
o 2 - 内存拒绝等于或者大于总可用 swap 大小以及 overcommit_ratio 指定的物理 RAM 比例的内存请求。如果您希望减小内存过度使用的风险，这个设置就是最好的。
注意
只为 swap 区域大于其物理内存的系统推荐这个设置。
overcommit_ratio
将 overcommit_memory 设定为 2 时，指定所考虑的物理 RAM 比例。默认为 50。
max_map_count
规定某个进程可能使用的最大内存映射区域。在大多数情况下，默认值 65530 就很合适。如果您的程序需要映射比这个文件数更多的文件可增大这个值。
nr_hugepages
规定在内核中配置的超大页数。默认值为 0。只有系统中有足够的连续可用页时方可分配（或者取消分配）超大页。为这个参数保留的页无法用于其他目的。安装的文件 /usr/share/doc/kernel-doc-kernel_version/Documentation/vm/hugetlbpage.txt 中有详细的内容。
与容量相关的内核可调参数
以下参数位于 proc 文件系统的 /proc/sys/kernel/ 目录中。
msgmax
以字节为单位规定信息队列中任意信息的最大允许大小。这个值一定不能超过该队列的大小（msgmnb）。默认值为 65536。
msgmnb
以字节为单位规定单一信息队列的最大值。默认为 65536 字节。
msgmni
规定信息队列识别符的最大数量（以及队列的最大数量）。64 位架构机器的默认值为 1985；32 位架构机器的默认值为 1736。
shmall
以字节为单位规定一次在该系统中可以使用的共享内存总量。64 位架构机器的默认值为 4294967296；32 位架构机器的默认值为 268435456。
shmmax
以字节为单位规定内核可允许的最大共享内存片段。64 位架构机器的默认值为 68719476736；32 位架构机器的默认值为 4294967295。注：但内核支持的值比这个值要多得多。
shmmni
规定系统范围内最大共享内存片段。在 64 位和 32 位架构机器中的默认值都是 4096。
threads-max
规定一次内核使用的最大线程（任务）数。默认值与 max_threads 相同。使用的方程式是：
max_threads = mempages / (8 * THREAD_SIZE / PAGE_SIZE )
threads-max 的最小值为 20。
与容量相关的文件系统可调参数
以下参数位于 proc 文件系统的 /proc/sys/fs/ 目录中。
aio-max-nr
规定在所有活动异步 I/O 上下文中可允许的最多事件数。默认值为 65536。注：更改这个值不会预先分配或者重新定义内核数据结构大小。
file-max
列出内核分配的文件句柄最大值。默认值与内核中的 files_stat.max_files 映射，该参数可将最大值设定为 (mempages * (PAGE_SIZE / 1024)) / 10 或者 NR_FILE（在红帽企业版 Linux 中是 8192）。增大这个值可解决由于缺少文件句柄而造成的错误。
Out-of-Memory Kill 可调参数
内存不足（OOM）指的是所有可用内存，包括 swap 空间都已被分配的计算状态。默认情况下，这个状态可造成系统 panic，并停止如预期般工作。但将 /proc/sys/vm/panic_on_oom 参数设定为 0 会让内核在出现 OOM 时调用 oom_killer 功能。通常 oom_killer 可杀死偷盗进程，并让系统正常工作。
可在每个进程中设定以下参数，提高您对被 oom_killer 功能杀死的进程的控制。它位于 proc 文件系统中 /proc/pid/ 目录下，其中 pid 是进程 ID。
oom_adj
定义 -16 到 15 之间的一个数值以便帮助决定某个进程的 oom_score。oom_score 值越高，被 oom_killer 杀死的进程数就越多。将 oom_adj 值设定为 -17 则为该进程禁用 oom_killer。
重要
由任意调整的进程衍生的任意进程将继承该进程的 oom_score。例如：如果 sshd 进程不受 oom_killer功能影响，所有由 SSH 会话产生的进程都将不受其影响。这可在出现 OOM 时影响 oom_killer 功能救援系统的能力。</p>

<p>来自 <a href="https://access.redhat.com/documentation/zh-CN/Red_Hat_Enterprise_Linux/6/html/Performance_Tuning_Guide/s-memory-captun.html">https://access.redhat.com/documentation/zh-CN/Red_Hat_Enterprise_Linux/6/html/Performance_Tuning_Guide/s-memory-captun.html</a></p>

    </div>

  </div>
</body>

<footer>
    <div class="container">
        <div class="row footer-links">
            <div class="col-lg-2 col-sm-2">
                <h3>友情链接</h3>
                <ul>
                    <li><a href="">友链位招租</a></li>
                    <li><a href="">友链位招租</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>没想好</h3>
                <ul>
                    <li><a href="">我爸没想好</a></li>
                    <li><a href="">我哥说我爸没想好</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>Hooray</h3>
                <ul>
                    <li><a href="">Hooray</a></li>
                    <li><a href="">What are we Hooray For?</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>前面的footer太浪了</h3>
                <ul>
                    <li><a href="">就是就是</a></li>
                    <li><a href="">偷偷的表示羡慕</a></li>
                </ul>
            </div>
            <div class="col-lg-4 col-sm-4">
                <h3>网站信息</h3>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <div class="fine-print">
                    <p>网战由以下技术支撑</p>
                    <ul>
                        <li>Markdown Processor: <a href="https://github.com/russross/blackfriday/tree/v2">Blackfriday V2</a></li>
                        <li>Renderer Engine: <a href="https://github.com/Depado/bfchroma/">bfchroma</a></li>
                        <li>Syntax Highlighter: <a href="https://github.com/alecthomas/chroma">Chroma</a></li>
                        <li>Coding Language: <a href="https://go.dev/">Golang</a></li>
                        <li>Others: Markdown, HTML, CSS</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>

</html>