<!DOCTYPE html>
<html lang="zh-cmn">

<head>
    <title>XTY Blog | Linux Ops Docs | SRE | DEVOPS</title>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <link rel="stylesheet" href="/static/css/chroma.css">
    <link rel="stylesheet" href="/static/css/main.css">
</head>

<div class="blog-title">
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<div>
					<a class="main-title" href="/">XTY的小站</a>
                </div>
                <div>
                    <a class="small-title" href="/">记录技术笔记和技术博客</a>
                </div>
			</div>
		</div>
	</div>
</div>

<body>
  <div class="container">

    <div class="col-lg-4 col-lg-offset-1 col-md-4 col-md-offset-1 col-sm-4 col-sm-offset-1">
	  <div id="sidebar">

		<h3>最新文章</h3>
          <ul>

            <li>
              <a href="/linux/advance/memory_03_general_memory_layout.html">内存: 进程内存布局 - 堆栈</a>
            </li>
            <li>
              <a href="/service/nginx/nginx_2.1.9.03_configuration_log.html">nginx: 配置 - 日志</a>
            </li>
            <li>
              <a href="/linux/advance/network_tunnel-ipip.html">网络: 隧道 - IPIP</a>
            </li>
            <li>
              <a href="/linux/advance/network_ip-address.html">网络: IP - IP地址简介</a>
            </li>
            <li>
              <a href="/linux/advance/bash_02_00_login_shell_vs_non_login_shell.html">bash: login shell vs non-login shell</a>
            </li>
          </ul>

		<h3>文章分类</h3>
		  <ul>

            <li>
              <a href="/android/index.html">android</a>
            </li>
            <li>
              <a href="/bigdata/index.html">bigdata</a>
            </li>
            <li>
              <a href="/blockchain/index.html">blockchain</a>
            </li>
            <li>
              <a href="/blog/index.html">blog</a>
            </li>
            <li>
              <a href="/cloud/index.html">cloud</a>
            </li>
            <li>
              <a href="/cryptography/index.html">cryptography</a>
            </li>
            <li>
              <a href="/database/index.html">database</a>
            </li>
            <li>
              <a href="/devops/index.html">devops</a>
            </li>
            <li>
              <a href="/go/index.html">go</a>
            </li>
            <li>
              <a href="/ios/index.html">ios</a>
            </li>
            <li>
              <a href="/java/index.html">java</a>
            </li>
            <li>
              <a href="/linux/index.html">linux</a>
            </li>
            <li>
              <a href="/python/index.html">python</a>
              <ul>
                <li>
                  <a href="/python/advance/index.html">advance</a>
                  <ul>
                    <li><a href="/python/advance/DECORATOR.html">DECORATOR</a></li>
                    <li><a href="/python/advance/ENCODE_字符串和16进制转换.html">ENCODE: 字符串和16进制转换</a></li>
                    <li><a href="/python/advance/FAB_函数对外接口控制.html">FAB: 函数对外接口控制</a></li>
                    <li><a href="/python/advance/FORMAT_字符串格式化.html">FORMAT: 字符串格式化</a></li>
                    <li><a href="/python/advance/PEP8_F821undefinedname.html">PEP8: F821 undefined name</a></li>
                    <li><a href="/python/advance/PEP8_flake8.html">PEP8: flake8</a></li>
                    <li><a href="/python/advance/SCRIPTS_change_file_extension.html">how to change file extension by using shell and python</a></li>
                    <li><a href="/python/advance/SCRIPTS_nginx日志分析_配置修改.html">SCRIPTS: nginx日志分析&配置修改</a></li>
                    <li><a href="/python/advance/SCRIPTS_ssh-key批量生成及分发.html">SCRIPTS: ssh-key批量生成及分发</a></li>
                    <li><a href="/python/advance/SCRIPTS_测试网页访问速度.html">SCRIPTS: 测试网页访问速度</a></li>
                    <li><a href="/python/advance/class_new_class_vs_old_class.html">CLASS: new style class vs old style class (inspect)</a></li>
                    <li><a href="/python/advance/envtool_1.0_pip.html">工具: 1.0 pip-包管理工具</a></li>
                    <li><a href="/python/advance/envtool_1.1_pip_advance.html">工具: 1.1 pip-查看包可选版本</a></li>
                    <li><a href="/python/advance/envtool_2.0_virtualenv.html">工具: 2.0 virtualenv-python虚拟环境</a></li>
                    <li><a href="/python/advance/error_1.0_ipython_tab_fail.html">错误: 1.0 ipython无法tab补全</a></li>
                    <li><a href="/python/advance/error_2.0_virtualenv_create_fail.html">错误: 2.0 virtualenv在多py版本环境下报错</a></li>
                    <li><a href="/python/advance/error_3.0_CTR_mode_needs_counter_parameter_not_IV.html">错误: 3.0 CTR mode needs counter parameter, not IV</a></li>
                    <li><a href="/python/advance/function_isinstance.html">函数: isinstance</a></li>
                    <li><a href="/python/advance/function_os.walk.html">函数: 使用os的walk方法遍历目录下的文件</a></li>
                    <li><a href="/python/advance/function_raw_input_vs_input.html">函数: raw_input() vs input()</a></li>
                    <li><a href="/python/advance/generator-从零开始学Python第二版-极客学院Wiki.html">生成器 - 《从零开始学 Python》(第二版) - 极客学院Wiki</a></li>
                    <li><a href="/python/advance/1.1.0_filter_list_dict_set.html">1.1.0 筛选数据(列表、字典、集合)高级用法</a></li>
                    <li><a href="/python/advance/1.2.0_namedtuple_make_tuple_easy_read.html">1.2.0 使tuple易读的几种方法</a></li>
                    <li><a href="/python/advance/1.3.0_statistics_frequency.html">1.3.0 统计列表中元素的频度</a></li>
                    <li><a href="/python/advance/1.4.0_sorted_dict_by_value.html">1.4.0 根据字典的值进行排序</a></li>
                    <li><a href="/python/advance/1.4.1_operator_itemgetter.html">1.4.1 字典排序-operator.itemgetter</a></li>
                    <li><a href="/python/advance/1.5.0_get_public_keys_between_dict.html">1.5.0 寻找dict公共key</a></li>
                    <li><a href="/python/advance/1.6.0_ordered_dict.html">1.6.0 如何让字典保持有序</a></li>
                    <li><a href="/python/advance/1.7.0_collections_deque.html">1.7.0 创建固定长度的队列</a></li>
                    <li><a href="/python/advance/1.7.1_pickle_dump_load_data.html">1.7.1 创建队列-记录持久化pickle</a></li>
                    <li><a href="/python/advance/2.1.0_iterable_object.html">2.1.0 可迭代对象与迭代器</a></li>
                    <li><a href="/python/advance/2.2.0_custom_iterable_object.html">2.2.0 如何创建一个可迭代对象</a></li>
                    <li><a href="/python/advance/2.3.0_generator.html">2.3.0 构造一个生成器</a></li>
                    <li><a href="/python/advance/2.3.1_generator_recursive.html">2.3.1 构造一个递归的生成器</a></li>
                    <li><a href="/python/advance/2.4.0_reverse_iterate.html">2.4.0 如何进行逆序迭代</a></li>
                    <li><a href="/python/advance/2.5.0_iterator_slice.html">2.5.0 如何对迭代器进行切片操作</a></li>
                    <li><a href="/python/advance/2.6.0_iterator_multiple_for.html">2.6.0 如何对多个迭代器同时进行操作</a></li>
                    <li><a href="/python/advance/3.1.0_read_file.html">3.1.0 如何读取文件</a></li>
                    <li><a href="/python/advance/3.2.0_process_bin_file.html">3.2.0 如何处理二进制文件</a></li>
                    <li><a href="/python/advance/module_1.1.0_XlsxWriter.html">module: 1.1.0 XlsxWriter 初识</a></li>
                    <li><a href="/python/advance/python_run_cd.html">如何在python程序中执行"cd"命令</a></li>
                    <li><a href="/python/advance/script_replace_str_in_file.html">脚本: 替换字符串</a></li>
                    <li><a href="/python/advance/sort_1.0_sort_list_by_num.html">排序: 1.0 list按数字排序</a></li>
                    <li><a href="/python/advance/str_rsplit.html">str: rsplit的用法</a></li>
                    <li><a href="/python/advance/syntax_advance_if_statement.html">语法: 简易if语句</a></li>
                    <li><a href="/python/advance/unicode_error_open_codecs.html">codecs解决open()向文件写入Unicode时出现的Error</a></li>
                    <li><a href="/python/advance/url访问时间和状态.html">url访问时间和状态</a></li>
                    <li><a href="/python/advance/version_1.0_python2.7.html">版本: 1.0 python2.7:安装</a></li>
                    <li><a href="/python/advance/version_2.0_python3.5.2.html">版本: 2.0 python3.5.2:安装</a></li>
                    <li><a href="/python/advance/virtualenv_protocol_error.html">virtualenv: protocol error</a></li>
                    <li><a href="/python/advance/单例模式_PythonOnetoMillion.html">单例模式 | Python One to Million</a></li>
                    <li><a href="/python/advance/异常处理_捕获全部异常.html">异常处理: 捕获全部异常</a></li>
                    <li><a href="/python/advance/模块_Requests-爬虫.html">模块: Requests-爬虫</a></li>
                    <li><a href="/python/advance/模块_datetime.html">模块: datetime</a></li>
                    <li><a href="/python/advance/模块_timeit.html">模块: timeit</a></li>
                    <li><a href="/python/advance/脚本知识_给python脚本传参.html">脚本知识: 给python脚本传参</a></li>
                  </ul>
                </li>
                <li>
                  <a href="/python/basic/index.html">basic</a>
                </li>
                <li>
                  <a href="/python/codefights/index.html">codefights</a>
                </li>
                <li>
                  <a href="/python/django/index.html">django</a>
                </li>
                <li>
                  <a href="/python/flask/index.html">flask</a>
                </li>
                <li>
                  <a href="/python/fluent_py/index.html">fluent_py</a>
                </li>
                <li>
                  <a href="/python/py_tour/index.html">py_tour</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="/service/index.html">service</a>
            </li>
            <li>
              <a href="/virtualization/index.html">virtualization</a>
            </li>
            <li>
              <a href="/web/index.html">web</a>
            </li>
          </ul>

      </div>
    </div>

    <div class="col-lg-7 col-md-7 col-sm-7">
      <h2>DECORATOR</h2>
      <div>
        <hr style="border: 0; border-top: 1px dashed #a2a9b6">
      </div>
      <div class="postDate">
        <p>13 Aug 2015</p>
      </div>
      <div>
        <hr style="border: 0; border-bottom: 1px dashed #a2a9b6">
      </div>
<h2>Decorator Basics</h2>

<p>Python&rsquo;s functions are objects</p>

<p>To understand decorators, you must first understand that functions are objects in Python. This has important consequences. Let&rsquo;s see why with a simple example :</p>
<pre class="chroma"><span class="k">def</span> <span class="nf">shout</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">yes</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">word</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(</span><span class="p">)</span><span class="o">+</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">!</span><span class="s2">&#34;</span>

<span class="k">print</span> <span class="n">shout</span><span class="p">(</span><span class="p">)</span>
<span class="c1"># outputs : &#39;Yes!&#39;</span>

<span class="c1"># As an object, you can assign the function to a variable like any other object</span>

<span class="n">scream</span> <span class="o">=</span> <span class="n">shout</span>
</pre>
<p>Notice we don&rsquo;t use parentheses: we are not calling the function, we are
putting the function &ldquo;shout&rdquo; into the variable &ldquo;scream&rdquo;.
It means you can then call &ldquo;shout&rdquo; from &ldquo;scream&rdquo;:</p>
<pre class="chroma"><span class="k">print</span> <span class="n">scream</span><span class="p">(</span><span class="p">)</span>
<span class="c1"># outputs : &#39;Yes!&#39;</span>

<span class="c1"># More than that, it means you can remove the old name &#39;shout&#39;, and</span>
<span class="c1"># the function will still be accessible from &#39;scream&#39;</span>

<span class="k">del</span> <span class="n">shout</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">shout</span><span class="p">(</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">e</span>
    <span class="c1">#outputs: &#34;name &#39;shout&#39; is not defined&#34;</span>

<span class="k">print</span> <span class="n">scream</span><span class="p">(</span><span class="p">)</span>
<span class="c1"># outputs: &#39;Yes!&#39;</span>
</pre>
<p>Okay! Keep this in mind. We&rsquo;ll circle back to it shortly.</p>

<p>Another interesting property of Python functions is they can be defined&hellip; inside another function!</p>
<pre class="chroma"><span class="k">def</span> <span class="nf">talk</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>

    <span class="c1"># You can define a function on the fly in &#34;talk&#34; ...</span>
    <span class="k">def</span> <span class="nf">whisper</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">yes</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="p">)</span><span class="o">+</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">...</span><span class="s2">&#34;</span>

    <span class="c1"># ... and use it right away!</span>

    <span class="k">print</span> <span class="n">whisper</span><span class="p">(</span><span class="p">)</span>
</pre>
<p>You call &ldquo;talk&rdquo;, that defines &ldquo;whisper&rdquo; EVERY TIME you call it, then
&ldquo;whisper&rdquo; is called in &ldquo;talk&rdquo;.</p>
<pre class="chroma"><span class="n">talk</span><span class="p">(</span><span class="p">)</span>
<span class="c1"># outputs:</span>
<span class="c1"># &#34;yes...&#34;</span>
</pre>
<p>But &ldquo;whisper&rdquo; DOES NOT EXIST outside &ldquo;talk&rdquo;:</p>
<pre class="chroma"><span class="k">try</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">whisper</span><span class="p">(</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">e</span>
    <span class="c1">#outputs : &#34;name &#39;whisper&#39; is not defined&#34;*</span>
    <span class="n">Python</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">s functions are objects</span>
</pre>
<h2>Functions references</h2>

<p>Okay, still here? Now the fun part&hellip;</p>

<p>You&rsquo;ve seen that functions are objects. Therefore, functions:</p>

<ul>
<li>can be assigned to a variable</li>
<li>can be defined in another function</li>
</ul>

<p>That means that a function can return another function. Have a look! ?</p>
<pre class="chroma"><span class="k">def</span> <span class="nf">getTalk</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">shout</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">:</span>

    <span class="c1"># We define functions on the fly</span>
    <span class="k">def</span> <span class="nf">shout</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">yes</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">word</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(</span><span class="p">)</span><span class="o">+</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">!</span><span class="s2">&#34;</span>

    <span class="k">def</span> <span class="nf">whisper</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">yes</span><span class="s2">&#34;</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="p">)</span><span class="o">+</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">...</span><span class="s2">&#34;</span><span class="p">;</span>

    <span class="c1"># Then we return one of them</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">shout</span><span class="s2">&#34;</span><span class="p">:</span>
        <span class="c1"># We don&#39;t use &#34;()&#34;, we are not calling the function,</span>
        <span class="c1"># we are returning the function object</span>
        <span class="k">return</span> <span class="n">shout</span>  
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">whisper</span>
</pre>
<p>How do you use this strange beast?</p>
<pre class="chroma"><span class="c1"># Get the function and assign it to a variable</span>
<span class="n">talk</span> <span class="o">=</span> <span class="n">getTalk</span><span class="p">(</span><span class="p">)</span>      

<span class="c1"># You can see that &#34;talk&#34; is here a function object:</span>
<span class="k">print</span> <span class="n">talk</span>
<span class="c1">#outputs : &lt;function shout at 0xb7ea817c&gt;</span>

<span class="c1"># The object is the one returned by the function:</span>
<span class="k">print</span> <span class="n">talk</span><span class="p">(</span><span class="p">)</span>
<span class="c1">#outputs : Yes!</span>

<span class="c1"># And you can even use it directly if you feel wild:</span>
<span class="k">print</span> <span class="n">getTalk</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">whisper</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">(</span><span class="p">)</span>
<span class="c1">#outputs : yes...</span>
</pre>
<p>But wait&hellip;there&rsquo;s more!</p>

<p>If you can return a function, you can pass one as a parameter:</p>
<pre class="chroma"><span class="k">def</span> <span class="nf">doSomethingBefore</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I do something before then I call the function you gave me</span><span class="s2">&#34;</span>
    <span class="k">print</span> <span class="n">func</span><span class="p">(</span><span class="p">)</span>

<span class="n">doSomethingBefore</span><span class="p">(</span><span class="n">scream</span><span class="p">)</span>
<span class="c1">#outputs:</span>
<span class="c1">#I do something before then I call the function you gave me</span>
<span class="c1">#Yes!</span>
</pre>
<p>Well, you just have everything needed to understand decorators. You see, decorators are &ldquo;wrappers&rdquo;, which means that they let you execute code before and after the function they decorate without modifying the function itself.
Handcrafted decorators</p>

<p>How you&rsquo;d do it manually:</p>
<pre class="chroma"><span class="c1"># A decorator is a function that expects ANOTHER function as parameter</span>
<span class="k">def</span> <span class="nf">my_shiny_new_decorator</span><span class="p">(</span><span class="n">a_function_to_decorate</span><span class="p">)</span><span class="p">:</span>

    <span class="c1"># Inside, the decorator defines a function on the fly: the wrapper.</span>
    <span class="c1"># This function is going to be wrapped around the original function</span>
    <span class="c1"># so it can execute code before and after it.</span>
    <span class="k">def</span> <span class="nf">the_wrapper_around_the_original_function</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>

        <span class="c1"># Put here the code you want to be executed BEFORE the original</span>
        <span class="c1"># function is called</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Before the function runs</span><span class="s2">&#34;</span>

        <span class="c1"># Call the function here (using parentheses)</span>
        <span class="n">a_function_to_decorate</span><span class="p">(</span><span class="p">)</span>

        <span class="c1"># Put here the code you want to be executed AFTER the original</span>
        <span class="c1"># function is called</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">After the function runs</span><span class="s2">&#34;</span>

    <span class="c1"># At this point, &#34;a_function_to_decorate&#34; HAS NEVER BEEN EXECUTED.</span>
    <span class="c1"># We return the wrapper function we have just created.</span>
    <span class="c1"># The wrapper contains the function and the code to execute before</span>
    <span class="c1"># and after. It&#39;s ready to use!</span>
    <span class="k">return</span> <span class="n">the_wrapper_around_the_original_function</span>

<span class="c1"># Now imagine you create a function you don&#39;t want to ever touch again.</span>
<span class="k">def</span> <span class="nf">a_stand_alone_function</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I am a stand alone function, don</span><span class="s2">&#39;</span><span class="s2">t you dare modify me</span><span class="s2">&#34;</span>

<span class="n">a_stand_alone_function</span><span class="p">(</span><span class="p">)</span>
<span class="c1">#outputs: I am a stand alone function, don&#39;t you dare modify me</span>

<span class="c1"># Well, you can decorate it to extend its behavior.</span>
<span class="c1"># Just pass it to the decorator, it will wrap it dynamically in</span>
<span class="c1"># any code you want and return you a new function ready to be used:</span>

<span class="n">a_stand_alone_function_decorated</span> <span class="o">=</span> <span class="n">my_shiny_new_decorator</span><span class="p">(</span><span class="n">a_stand_alone_function</span><span class="p">)</span>
<span class="n">a_stand_alone_function_decorated</span><span class="p">(</span><span class="p">)</span>
<span class="c1">#outputs:</span>
<span class="c1">#Before the function runs</span>
<span class="c1">#I am a stand alone function, don&#39;t you dare modify me</span>
<span class="c1">#After the function runs</span>
</pre>
<p>Now, you probably want that every time you call a_stand_alone_function, a_stand_alone_function_decorated is called instead. That&rsquo;s easy, just overwrite a_stand_alone_function with the function returned by my_shiny_new_decorator:</p>
<pre class="chroma"><span class="n">a_stand_alone_function</span> <span class="o">=</span> <span class="n">my_shiny_new_decorator</span><span class="p">(</span><span class="n">a_stand_alone_function</span><span class="p">)</span>
<span class="n">a_stand_alone_function</span><span class="p">(</span><span class="p">)</span>
<span class="c1">#outputs:</span>
<span class="c1">#Before the function runs</span>
<span class="c1">#I am a stand alone function, don&#39;t you dare modify me</span>
<span class="c1">#After the function runs</span>

<span class="c1"># And guess what? That&#39;s EXACTLY what decorators do!</span>
</pre>
<h2>Decorators demystified</h2>

<p>The previous example, using the decorator syntax:</p>
<pre class="chroma"><span class="nd">@my_shiny_new_decorator</span>
<span class="k">def</span> <span class="nf">another_stand_alone_function</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Leave me alone</span><span class="s2">&#34;</span>

<span class="n">another_stand_alone_function</span><span class="p">(</span><span class="p">)</span>  
<span class="c1">#outputs:  </span>
<span class="c1">#Before the function runs</span>
<span class="c1">#Leave me alone</span>
<span class="c1">#After the function runs</span>
</pre>
<p>Yes, that&rsquo;s all, it&rsquo;s that simple. @decorator is just a shortcut to:</p>

<p>another_stand_alone_function = my_shiny_new_decorator(another_stand_alone_function)</p>

<p>Decorators are just a pythonic variant of the decorator design pattern. There are several classic design patterns embedded in Python to ease development (like iterators).</p>

<p>Of course, you can accumulate decorators:</p>
<pre class="chroma"><span class="k">def</span> <span class="nf">bread</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">&lt;/</span><span class="s2">&#39;</span><span class="s2">&#39;</span><span class="s2">&#39;</span><span class="s2">&#39;</span><span class="s2">&#39;</span><span class="s2">&#39;</span><span class="s2">\</span><span class="s2">&gt;</span><span class="s2">&#34;</span>
        <span class="n">func</span><span class="p">(</span><span class="p">)</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">&lt;</span><span class="s2">\</span><span class="s2">______/&gt;</span><span class="s2">&#34;</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="k">def</span> <span class="nf">ingredients</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">#tomatoes#</span><span class="s2">&#34;</span>
        <span class="n">func</span><span class="p">(</span><span class="p">)</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">~salad~</span><span class="s2">&#34;</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="k">def</span> <span class="nf">sandwich</span><span class="p">(</span><span class="n">food</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">--ham--</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">food</span>

<span class="n">sandwich</span><span class="p">(</span><span class="p">)</span>
<span class="c1">#outputs: --ham--</span>
<span class="n">sandwich</span> <span class="o">=</span> <span class="n">bread</span><span class="p">(</span><span class="n">ingredients</span><span class="p">(</span><span class="n">sandwich</span><span class="p">)</span><span class="p">)</span>
<span class="n">sandwich</span><span class="p">(</span><span class="p">)</span>
<span class="c1">#outputs:</span>
<span class="c1">#&lt;/&#39;&#39;&#39;&#39;&#39;&#39;\&gt;</span>
<span class="c1"># #tomatoes#</span>
<span class="c1"># --ham--</span>
<span class="c1"># ~salad~</span>
<span class="c1">#&lt;\______/&gt;</span>
</pre>
<p>Using the Python decorator syntax:</p>
<pre class="chroma"><span class="nd">@bread</span>
<span class="nd">@ingredients</span>
<span class="k">def</span> <span class="nf">sandwich</span><span class="p">(</span><span class="n">food</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">--ham--</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">food</span>

<span class="n">sandwich</span><span class="p">(</span><span class="p">)</span>
<span class="c1">#outputs:</span>
<span class="c1">#&lt;/&#39;&#39;&#39;&#39;&#39;&#39;\&gt;</span>
<span class="c1"># #tomatoes#</span>
<span class="c1"># --ham--</span>
<span class="c1"># ~salad~</span>
<span class="c1">#&lt;\______/&gt;</span>
</pre>
<p>The order you set the decorators MATTERS:</p>
<pre class="chroma"><span class="nd">@ingredients</span>
<span class="nd">@bread</span>
<span class="k">def</span> <span class="nf">strange_sandwich</span><span class="p">(</span><span class="n">food</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">--ham--</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">food</span>

<span class="n">strange_sandwich</span><span class="p">(</span><span class="p">)</span>
<span class="c1">#outputs:</span>
<span class="c1">##tomatoes#</span>
<span class="c1">#&lt;/&#39;&#39;&#39;&#39;&#39;&#39;\&gt;</span>
<span class="c1"># --ham--</span>
<span class="c1">#&lt;\______/&gt;</span>
<span class="c1"># ~salad~</span>
</pre>
<p>Now: to answer the question&hellip;</p>

<p>As a conclusion, you can easily see how to answer the question:</p>
<pre class="chroma"><span class="c1"># The decorator to make it bold</span>
<span class="k">def</span> <span class="nf">makebold</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="p">:</span>
    <span class="c1"># The new function the decorator returns</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
        <span class="c1"># Insertion of some code before and after</span>
        <span class="k">return</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">&lt;b&gt;</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="n">fn</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">&lt;/b&gt;</span><span class="s2">&#34;</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="c1"># The decorator to make it italic</span>
<span class="k">def</span> <span class="nf">makeitalic</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="p">:</span>
    <span class="c1"># The new function the decorator returns</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
        <span class="c1"># Insertion of some code before and after</span>
        <span class="k">return</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">&lt;i&gt;</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="n">fn</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">&lt;/i&gt;</span><span class="s2">&#34;</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@makebold</span>
<span class="nd">@makeitalic</span>
<span class="k">def</span> <span class="nf">say</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="k">return</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">hello</span><span class="s2">&#34;</span>

<span class="k">print</span> <span class="n">say</span><span class="p">(</span><span class="p">)</span>
<span class="c1">#outputs: &lt;b&gt;&lt;i&gt;hello&lt;/i&gt;&lt;/b&gt;</span>

<span class="c1"># This is the exact equivalent to</span>
<span class="k">def</span> <span class="nf">say</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="k">return</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">hello</span><span class="s2">&#34;</span>
<span class="n">say</span> <span class="o">=</span> <span class="n">makebold</span><span class="p">(</span><span class="n">makeitalic</span><span class="p">(</span><span class="n">say</span><span class="p">)</span><span class="p">)</span>

<span class="k">print</span> <span class="n">say</span><span class="p">(</span><span class="p">)</span>
<span class="c1">#outputs: &lt;b&gt;&lt;i&gt;hello&lt;/i&gt;&lt;/b&gt;</span>
</pre>
<p>You can now just leave happy, or burn your brain a little bit more and see advanced uses of decorators.
Taking decorators to the next level
Passing arguments to the decorated function</p>
<pre class="chroma"><span class="c1"># It&#39;s not black magic, you just have to let the wrapper</span>
<span class="c1"># pass the argument:</span>

<span class="k">def</span> <span class="nf">a_decorator_passing_arguments</span><span class="p">(</span><span class="n">function_to_decorate</span><span class="p">)</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">a_wrapper_accepting_arguments</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span><span class="p">:</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I got args! Look:</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span>
        <span class="n">function_to_decorate</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a_wrapper_accepting_arguments</span>

<span class="c1"># Since when you are calling the function returned by the decorator, you are</span>
<span class="c1"># calling the wrapper, passing arguments to the wrapper will let it pass them to</span>
<span class="c1"># the decorated function</span>

<span class="nd">@a_decorator_passing_arguments</span>
<span class="k">def</span> <span class="nf">print_full_name</span><span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">My name is</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span>

<span class="n">print_full_name</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">Peter</span><span class="s2">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Venkman</span><span class="s2">&#34;</span><span class="p">)</span>
<span class="c1"># outputs:</span>
<span class="c1">#I got args! Look: Peter Venkman</span>
<span class="c1">#My name is Peter Venkman</span>
</pre>
<h2>Decorating methods</h2>

<p>One nifty thing about Python is that methods and functions are really the same. The only difference is that methods expect that their first argument is a reference to the current object (self).</p>

<p>That means you can build a decorator for methods the same way! Just remember to take self into consideration:</p>
<pre class="chroma"><span class="k">def</span> <span class="nf">method_friendly_decorator</span><span class="p">(</span><span class="n">method_to_decorate</span><span class="p">)</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lie</span><span class="p">)</span><span class="p">:</span>
        <span class="n">lie</span> <span class="o">=</span> <span class="n">lie</span> <span class="o">-</span> <span class="mi">3</span> <span class="c1"># very friendly, decrease age even more :-)</span>
        <span class="k">return</span> <span class="n">method_to_decorate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lie</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">class</span> <span class="nc">Lucy</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">32</span>

    <span class="nd">@method_friendly_decorator</span>
    <span class="k">def</span> <span class="nf">sayYourAge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lie</span><span class="p">)</span><span class="p">:</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I am </span><span class="si">%s</span><span class="s2">, what did you think?</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">+</span> <span class="n">lie</span><span class="p">)</span>

<span class="n">l</span> <span class="o">=</span> <span class="n">Lucy</span><span class="p">(</span><span class="p">)</span>
<span class="n">l</span><span class="o">.</span><span class="n">sayYourAge</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">#outputs: I am 26, what did you think?</span>
</pre>
<p>If you&rsquo;re making general-purpose decorator&ndash;one you&rsquo;ll apply to any function or method, no matter its arguments&ndash;then just use *args, **kwargs:</p>
<pre class="chroma"><span class="k">def</span> <span class="nf">a_decorator_passing_arbitrary_arguments</span><span class="p">(</span><span class="n">function_to_decorate</span><span class="p">)</span><span class="p">:</span>
    <span class="c1"># The wrapper accepts any arguments</span>
    <span class="k">def</span> <span class="nf">a_wrapper_accepting_arbitrary_arguments</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="o">*</span><span class="n">kwargs</span><span class="p">)</span><span class="p">:</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Do I have args?:</span><span class="s2">&#34;</span>
        <span class="k">print</span> <span class="n">args</span>
        <span class="k">print</span> <span class="n">kwargs</span>
        <span class="c1"># Then you unpack the arguments, here *args, **kwargs</span>
        <span class="c1"># If you are not familiar with unpacking, check:</span>
        <span class="c1"># http://www.saltycrane.com/blog/2008/01/how-to-use-args-and-kwargs-in-python/</span>
        <span class="n">function_to_decorate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="o">*</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a_wrapper_accepting_arbitrary_arguments</span>

<span class="nd">@a_decorator_passing_arbitrary_arguments</span>
<span class="k">def</span> <span class="nf">function_with_no_argument</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Python is cool, no argument here.</span><span class="s2">&#34;</span>

<span class="n">function_with_no_argument</span><span class="p">(</span><span class="p">)</span>
<span class="c1">#outputs</span>
<span class="c1">#Do I have args?:</span>
<span class="c1">#()</span>
<span class="c1">#{}</span>
<span class="c1">#Python is cool, no argument here.</span>

<span class="nd">@a_decorator_passing_arbitrary_arguments</span>
<span class="k">def</span> <span class="nf">function_with_arguments</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>

<span class="n">function_with_arguments</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">#outputs</span>
<span class="c1">#Do I have args?:</span>
<span class="c1">#(1, 2, 3)</span>
<span class="c1">#{}</span>
<span class="c1">#1 2 3</span>

<span class="nd">@a_decorator_passing_arbitrary_arguments</span>
<span class="k">def</span> <span class="nf">function_with_named_arguments</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">platypus</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">Why not ?</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Do </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2"> like platypus? </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span>\
    <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">platypus</span><span class="p">)</span>

<span class="n">function_with_named_arguments</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">Bill</span><span class="s2">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Linus</span><span class="s2">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Steve</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">platypus</span><span class="o">=</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">Indeed!</span><span class="s2">&#34;</span><span class="p">)</span>
<span class="c1">#outputs</span>
<span class="c1">#Do I have args ? :</span>
<span class="c1">#(&#39;Bill&#39;, &#39;Linus&#39;, &#39;Steve&#39;)</span>
<span class="c1">#{&#39;platypus&#39;: &#39;Indeed!&#39;}</span>
<span class="c1">#Do Bill, Linus and Steve like platypus? Indeed!</span>

<span class="k">class</span> <span class="nc">Mary</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">31</span>

    <span class="nd">@a_decorator_passing_arbitrary_arguments</span>
    <span class="k">def</span> <span class="nf">sayYourAge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lie</span><span class="o">=</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="p">:</span> <span class="c1"># You can now add a default value</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I am </span><span class="si">%s</span><span class="s2">, what did you think ?</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">+</span> <span class="n">lie</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">Mary</span><span class="p">(</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">sayYourAge</span><span class="p">(</span><span class="p">)</span>
<span class="c1">#outputs</span>
<span class="c1"># Do I have args?:</span>
<span class="c1">#(&lt;__main__.Mary object at 0xb7d303ac&gt;,)</span>
<span class="c1">#{}</span>
<span class="c1">#I am 28, what did you think?</span>
</pre>
<p>Passing arguments to the decorator</p>

<p>Great, now what would you say about passing arguments to the decorator itself?</p>

<p>This can get somewhat twisted, since a decorator must accept a function as an argument. Therefore, you cannot pass the decorated function&rsquo;s arguments directly to the decorator.</p>

<p>Before rushing to the solution, let&rsquo;s write a little reminder:</p>
<pre class="chroma"><span class="c1"># Decorators are ORDINARY functions</span>
<span class="k">def</span> <span class="nf">my_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I am an ordinary function</span><span class="s2">&#34;</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I am function returned by the decorator</span><span class="s2">&#34;</span>
        <span class="n">func</span><span class="p">(</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="c1"># Therefore, you can call it without any &#34;@&#34;</span>

<span class="k">def</span> <span class="nf">lazy_function</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">zzzzzzzz</span><span class="s2">&#34;</span>

<span class="n">decorated_function</span> <span class="o">=</span> <span class="n">my_decorator</span><span class="p">(</span><span class="n">lazy_function</span><span class="p">)</span>
<span class="c1">#outputs: I am an ordinary function</span>

<span class="c1"># It outputs &#34;I am an ordinary function&#34;, because that&#39;s just what you do:</span>
<span class="c1"># calling a function. Nothing magic.</span>

<span class="nd">@my_decorator</span>
<span class="k">def</span> <span class="nf">lazy_function</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">zzzzzzzz</span><span class="s2">&#34;</span>

<span class="c1">#outputs: I am an ordinary function</span>
</pre>
<p>It&rsquo;s exactly the same. &ldquo;my_decorator&rdquo; is called. So when you @my_decorator, you are telling Python to call the function &lsquo;labelled by the variable &ldquo;my_decorator&rdquo;&rsquo;.</p>

<p>This is important! The label you give can point directly to the decorator-or not.</p>

<p>Let&rsquo;s get evil. ?</p>
<pre class="chroma"><span class="k">def</span> <span class="nf">decorator_maker</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>

    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I make decorators! I am executed only once: </span><span class="s2">&#34;</span><span class="o">+</span>\
          <span class="sa"></span><span class="s2">&#34;</span><span class="s2">when you make me create a decorator.</span><span class="s2">&#34;</span>

    <span class="k">def</span> <span class="nf">my_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="p">:</span>

        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I am a decorator! I am executed only when you decorate a function.</span><span class="s2">&#34;</span>

        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">I am the wrapper around the decorated function. </span><span class="s2">&#34;</span>
                  <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I am called when you call the decorated function. </span><span class="s2">&#34;</span>
                  <span class="sa"></span><span class="s2">&#34;</span><span class="s2">As the wrapper, I return the RESULT of the decorated function.</span><span class="s2">&#34;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="p">)</span>

        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">As the decorator, I return the wrapped function.</span><span class="s2">&#34;</span>

        <span class="k">return</span> <span class="n">wrapped</span>

    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">As a decorator maker, I return a decorator</span><span class="s2">&#34;</span>
    <span class="k">return</span> <span class="n">my_decorator</span>

<span class="c1"># Let&#39;s create a decorator. It&#39;s just a new function after all.</span>
<span class="n">new_decorator</span> <span class="o">=</span> <span class="n">decorator_maker</span><span class="p">(</span><span class="p">)</span>       
<span class="c1">#outputs:</span>
<span class="c1">#I make decorators! I am executed only once: when you make me create a decorator.</span>
<span class="c1">#As a decorator maker, I return a decorator</span>

<span class="c1"># Then we decorate the function</span>

<span class="k">def</span> <span class="nf">decorated_function</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I am the decorated function.</span><span class="s2">&#34;</span>

<span class="n">decorated_function</span> <span class="o">=</span> <span class="n">new_decorator</span><span class="p">(</span><span class="n">decorated_function</span><span class="p">)</span>
<span class="c1">#outputs:</span>
<span class="c1">#I am a decorator! I am executed only when you decorate a function.</span>
<span class="c1">#As the decorator, I return the wrapped function</span>

<span class="c1"># Let&#39;s call the function:</span>
<span class="n">decorated_function</span><span class="p">(</span><span class="p">)</span>
<span class="c1">#outputs:</span>
<span class="c1">#I am the wrapper around the decorated function. I am called when you call the decorated function.</span>
<span class="c1">#As the wrapper, I return the RESULT of the decorated function.</span>
<span class="c1">#I am the decorated function.</span>
</pre>
<p>No surprise here.</p>

<p>Let&rsquo;s do EXACTLY the same thing, but skip all the pesky intermediate variables:</p>
<pre class="chroma"><span class="k">def</span> <span class="nf">decorated_function</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I am the decorated function.</span><span class="s2">&#34;</span>
<span class="n">decorated_function</span> <span class="o">=</span> <span class="n">decorator_maker</span><span class="p">(</span><span class="p">)</span><span class="p">(</span><span class="n">decorated_function</span><span class="p">)</span>
<span class="c1">#outputs:</span>
<span class="c1">#I make decorators! I am executed only once: when you make me create a decorator.</span>
<span class="c1">#As a decorator maker, I return a decorator</span>
<span class="c1">#I am a decorator! I am executed only when you decorate a function.</span>
<span class="c1">#As the decorator, I return the wrapped function.</span>

<span class="c1"># Finally:</span>
<span class="n">decorated_function</span><span class="p">(</span><span class="p">)</span>    
<span class="c1">#outputs:</span>
<span class="c1">#I am the wrapper around the decorated function. I am called when you call the decorated function.</span>
<span class="c1">#As the wrapper, I return the RESULT of the decorated function.</span>
<span class="c1">#I am the decorated function.</span>

<span class="n">Let</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">s make it even shorter:</span>

<span class="nd">@decorator_maker</span><span class="p">(</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">decorated_function</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I am the decorated function.</span><span class="s2">&#34;</span>
<span class="c1">#outputs:</span>
<span class="c1">#I make decorators! I am executed only once: when you make me create a decorator.</span>
<span class="c1">#As a decorator maker, I return a decorator</span>
<span class="c1">#I am a decorator! I am executed only when you decorate a function.</span>
<span class="c1">#As the decorator, I return the wrapped function.</span>

<span class="c1">#Eventually:</span>
<span class="n">decorated_function</span><span class="p">(</span><span class="p">)</span>    
<span class="c1">#outputs:</span>
<span class="c1">#I am the wrapper around the decorated function. I am called when you call the decorated function.</span>
<span class="c1">#As the wrapper, I return the RESULT of the decorated function.</span>
<span class="c1">#I am the decorated function.</span>
</pre>
<p>Hey, did you see that? We used a function call with the &ldquo;@&rdquo; syntax! :-)</p>

<p>So, back to decorators with arguments. If we can use functions to generate the decorator on the fly, we can pass arguments to that function, right?</p>
<pre class="chroma"><span class="k">def</span> <span class="nf">decorator_maker_with_arguments</span><span class="p">(</span><span class="n">decorator_arg1</span><span class="p">,</span> <span class="n">decorator_arg2</span><span class="p">)</span><span class="p">:</span>

    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I make decorators! And I accept arguments:</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">decorator_arg1</span><span class="p">,</span> <span class="n">decorator_arg2</span>

    <span class="k">def</span> <span class="nf">my_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="p">:</span>
        <span class="c1"># The ability to pass arguments here is a gift from closures.</span>
        <span class="c1"># If you are not comfortable with closures, you can assume it&#39;s ok,</span>
        <span class="c1"># or read: http://stackoverflow.com/questions/13857/can-you-explain-closures-as-they-relate-to-python</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I am the decorator. Somehow you passed me arguments:</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">decorator_arg1</span><span class="p">,</span> <span class="n">decorator_arg2</span>

        <span class="c1"># Don&#39;t confuse decorator arguments and function arguments!</span>
        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="n">function_arg1</span><span class="p">,</span> <span class="n">function_arg2</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">I am the wrapper around the decorated function.</span><span class="se">\n</span><span class="s2">&#34;</span>
                  <span class="sa"></span><span class="s2">&#34;</span><span class="s2">I can access all the variables</span><span class="se">\n</span><span class="s2">&#34;</span>
                  <span class="sa"></span><span class="s2">&#34;</span><span class="se">\t</span><span class="s2">- from the decorator: {0} {1}</span><span class="se">\n</span><span class="s2">&#34;</span>
                  <span class="sa"></span><span class="s2">&#34;</span><span class="se">\t</span><span class="s2">- from the function call: {2} {3}</span><span class="se">\n</span><span class="s2">&#34;</span>
                  <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Then I can pass them to the decorated function</span><span class="s2">&#34;</span>
                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">decorator_arg1</span><span class="p">,</span> <span class="n">decorator_arg2</span><span class="p">,</span>
                          <span class="n">function_arg1</span><span class="p">,</span> <span class="n">function_arg2</span><span class="p">)</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">function_arg1</span><span class="p">,</span> <span class="n">function_arg2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapped</span>

    <span class="k">return</span> <span class="n">my_decorator</span>

<span class="nd">@decorator_maker_with_arguments</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">Leonard</span><span class="s2">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Sheldon</span><span class="s2">&#34;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">decorated_function_with_arguments</span><span class="p">(</span><span class="n">function_arg1</span><span class="p">,</span> <span class="n">function_arg2</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">I am the decorated function and only knows about my arguments: {0}</span><span class="s2">&#34;</span>
           <span class="sa"></span><span class="s2">&#34;</span><span class="s2"> {1}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">function_arg1</span><span class="p">,</span> <span class="n">function_arg2</span><span class="p">)</span><span class="p">)</span>

<span class="n">decorated_function_with_arguments</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">Rajesh</span><span class="s2">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Howard</span><span class="s2">&#34;</span><span class="p">)</span>
<span class="c1">#outputs:</span>
<span class="c1">#I make decorators! And I accept arguments: Leonard Sheldon</span>
<span class="c1">#I am the decorator. Somehow you passed me arguments: Leonard Sheldon</span>
<span class="c1">#I am the wrapper around the decorated function.</span>
<span class="c1">#I can access all the variables</span>
<span class="c1">#   - from the decorator: Leonard Sheldon</span>
<span class="c1">#   - from the function call: Rajesh Howard</span>
<span class="c1">#Then I can pass them to the decorated function</span>
<span class="c1">#I am the decorated function and only knows about my arguments: Rajesh Howard</span>

<span class="n">Here</span> <span class="n">it</span> <span class="ow">is</span><span class="p">:</span> <span class="n">a</span> <span class="n">decorator</span> <span class="k">with</span> <span class="n">arguments</span><span class="o">.</span> <span class="n">Arguments</span> <span class="n">can</span> <span class="n">be</span> <span class="nb">set</span> <span class="k">as</span> <span class="n">variable</span><span class="p">:</span>

<span class="n">c1</span> <span class="o">=</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Penny</span><span class="s2">&#34;</span>
<span class="n">c2</span> <span class="o">=</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Leslie</span><span class="s2">&#34;</span>

<span class="nd">@decorator_maker_with_arguments</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">Leonard</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">c1</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">decorated_function_with_arguments</span><span class="p">(</span><span class="n">function_arg1</span><span class="p">,</span> <span class="n">function_arg2</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">I am the decorated function and only knows about my arguments:</span><span class="s2">&#34;</span>
           <span class="sa"></span><span class="s2">&#34;</span><span class="s2"> {0} {1}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">function_arg1</span><span class="p">,</span> <span class="n">function_arg2</span><span class="p">)</span><span class="p">)</span>

<span class="n">decorated_function_with_arguments</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Howard</span><span class="s2">&#34;</span><span class="p">)</span>
<span class="c1">#outputs:</span>
<span class="c1">#I make decorators! And I accept arguments: Leonard Penny</span>
<span class="c1">#I am the decorator. Somehow you passed me arguments: Leonard Penny</span>
<span class="c1">#I am the wrapper around the decorated function.</span>
<span class="c1">#I can access all the variables</span>
<span class="c1">#   - from the decorator: Leonard Penny</span>
<span class="c1">#   - from the function call: Leslie Howard</span>
<span class="c1">#Then I can pass them to the decorated function</span>
<span class="c1">#I am the decorated function and only knows about my arguments: Leslie Howard</span>
</pre>
<p>As you can see, you can pass arguments to the decorator like any function using this trick. You can even use <code>*args</code>, <code>**kwargs</code> if you wish. But remember decorators are called only once. Just when Python imports the script. You can&rsquo;t dynamically set the arguments afterwards. When you do &ldquo;import x&rdquo;, the function is already decorated, so you can&rsquo;t change anything.
Let&rsquo;s practice: decorating a decorator</p>

<p>Okay, as a bonus, I&rsquo;ll give you a snippet to make any decorator accept generically any argument. After all, in order to accept arguments, we created our decorator using another function.</p>

<p>We wrapped the decorator.</p>

<p>Anything else we saw recently that wrapped function?</p>

<p>Oh yes, decorators!</p>

<p>Let&rsquo;s have some fun and write a decorator for the decorators:</p>
<pre class="chroma"><span class="k">def</span> <span class="nf">decorator_with_args</span><span class="p">(</span><span class="n">decorator_to_enhance</span><span class="p">)</span><span class="p">:</span>
    <span class="sa"></span><span class="s2">&#34;&#34;&#34;</span><span class="s2">
</span><span class="s2"></span><span class="s2">    This function is supposed to be used as a decorator.</span><span class="s2">
</span><span class="s2"></span><span class="s2">    It must decorate an other function, that is intended to be used as a decorator.</span><span class="s2">
</span><span class="s2"></span><span class="s2">    Take a cup of coffee.</span><span class="s2">
</span><span class="s2"></span><span class="s2">    It will allow any decorator to accept an arbitrary number of arguments,</span><span class="s2">
</span><span class="s2"></span><span class="s2">    saving you the headache to remember how to do that every time.</span><span class="s2">
</span><span class="s2"></span><span class="s2">    </span><span class="s2">&#34;&#34;&#34;</span>

    <span class="c1"># We use the same trick we did to pass arguments</span>
    <span class="k">def</span> <span class="nf">decorator_maker</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="o">*</span><span class="n">kwargs</span><span class="p">)</span><span class="p">:</span>

        <span class="c1"># We create on the fly a decorator that accepts only a function</span>
        <span class="c1"># but keeps the passed arguments from the maker.</span>
        <span class="k">def</span> <span class="nf">decorator_wrapper</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="p">:</span>

            <span class="c1"># We return the result of the original decorator, which, after all,</span>
            <span class="c1"># IS JUST AN ORDINARY FUNCTION (which returns a function).</span>
            <span class="c1"># Only pitfall: the decorator must have this specific signature or it won&#39;t work:</span>
            <span class="k">return</span> <span class="n">decorator_to_enhance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="o">*</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">decorator_wrapper</span>

    <span class="k">return</span> <span class="n">decorator_maker</span>
</pre>
<p>It can be used as follows:</p>
<pre class="chroma"><span class="c1"># You create the function you will use as a decorator. And stick a decorator on it :-)</span>
<span class="c1"># Don&#39;t forget, the signature is &#34;decorator(func, *args, **kwargs)&#34;</span>
<span class="nd">@decorator_with_args</span>
<span class="k">def</span> <span class="nf">decorated_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="o">*</span><span class="n">kwargs</span><span class="p">)</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">function_arg1</span><span class="p">,</span> <span class="n">function_arg2</span><span class="p">)</span><span class="p">:</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Decorated with</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">function_arg1</span><span class="p">,</span> <span class="n">function_arg2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="c1"># Then you decorate the functions you wish with your brand new decorated decorator.</span>

<span class="nd">@decorated_decorator</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">404</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">decorated_function</span><span class="p">(</span><span class="n">function_arg1</span><span class="p">,</span> <span class="n">function_arg2</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Hello</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">function_arg1</span><span class="p">,</span> <span class="n">function_arg2</span>

<span class="n">decorated_function</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">Universe and</span><span class="s2">&#34;</span><span class="p">,</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">everything</span><span class="s2">&#34;</span><span class="p">)</span>
<span class="c1">#outputs:</span>
<span class="c1">#Decorated with (42, 404, 1024) {}</span>
<span class="c1">#Hello Universe and everything</span>

<span class="c1"># Whoooot!</span>
</pre>
<p>I know, the last time you had this feeling, it was after listening a guy saying: &ldquo;before understanding recursion, you must first understand recursion&rdquo;. But now, don&rsquo;t you feel good about mastering this?
Best practices: decorators</p>
<pre class="chroma">Decorators were introduced in Python 2.4, so be sure your code will be run on &gt;= 2.4.
Decorators slow down the function call. Keep that in mind.
You cannot un-decorate a function. (There are hacks to create decorators that can be removed, but nobody uses them.) So once a function is decorated, it&#39;s decorated for all the code.
Decorators wrap functions, which can make them hard to debug. (This gets better from Python &gt;= 2.5; see below.)
</pre>
<p>The functools module was introduced in Python 2.5. It includes the function functools.wraps(), which copies the name, module, and docstring of the decorated function to its wrapper.</p>

<p>(Fun fact: functools.wraps() is a decorator! ?)</p>
<pre class="chroma"><span class="c1"># For debugging, the stacktrace prints you the function __name__</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">foo</span><span class="s2">&#34;</span>

<span class="k">print</span> <span class="n">foo</span><span class="o">.</span><span class="vm">__name__</span>
<span class="c1">#outputs: foo</span>

<span class="c1"># With a decorator, it gets messy    </span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">bar</span><span class="s2">&#34;</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@bar</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">foo</span><span class="s2">&#34;</span>

<span class="k">print</span> <span class="n">foo</span><span class="o">.</span><span class="vm">__name__</span>
<span class="c1">#outputs: wrapper</span>

<span class="c1"># &#34;functools&#34; can help for that</span>

<span class="kn">import</span> <span class="nn">functools</span>

<span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="p">:</span>
    <span class="c1"># We say that &#34;wrapper&#34;, is wrapping &#34;func&#34;</span>
    <span class="c1"># and the magic begins</span>
    <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">bar</span><span class="s2">&#34;</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@bar</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">foo</span><span class="s2">&#34;</span>

<span class="k">print</span> <span class="n">foo</span><span class="o">.</span><span class="vm">__name__</span>
<span class="c1">#outputs: foo</span>
</pre>
<p>How can the decorators be useful?</p>

<p>Now the big question: What can I use decorators for?</p>

<p>Seem cool and powerful, but a practical example would be great. Well, there are 1000 possibilities. Classic uses are extending a function behavior from an external lib (you can&rsquo;t modify it), or for debugging (you don&rsquo;t want to modify it because it&rsquo;s temporary).</p>

<p>You can use them to extend several functions in a DRY&rsquo;s way, like so:</p>
<pre class="chroma"><span class="k">def</span> <span class="nf">benchmark</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="p">:</span>
    <span class="sa"></span><span class="s2">&#34;&#34;&#34;</span><span class="s2">
</span><span class="s2"></span><span class="s2">    A decorator that prints the time a function takes</span><span class="s2">
</span><span class="s2"></span><span class="s2">    to execute.</span><span class="s2">
</span><span class="s2"></span><span class="s2">    </span><span class="s2">&#34;&#34;&#34;</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="o">*</span><span class="n">kwargs</span><span class="p">)</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">(</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="o">*</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">(</span><span class="p">)</span><span class="o">-</span><span class="n">t</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">logging</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="p">:</span>
    <span class="sa"></span><span class="s2">&#34;&#34;&#34;</span><span class="s2">
</span><span class="s2"></span><span class="s2">    A decorator that logs the activity of the script.</span><span class="s2">
</span><span class="s2"></span><span class="s2">    (it actually just prints it, but it could be logging!)</span><span class="s2">
</span><span class="s2"></span><span class="s2">    </span><span class="s2">&#34;&#34;&#34;</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="o">*</span><span class="n">kwargs</span><span class="p">)</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="o">*</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">counter</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="p">:</span>
    <span class="sa"></span><span class="s2">&#34;&#34;&#34;</span><span class="s2">
</span><span class="s2"></span><span class="s2">    A decorator that counts and prints the number of times a function has been executed</span><span class="s2">
</span><span class="s2"></span><span class="s2">    </span><span class="s2">&#34;&#34;&#34;</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="o">*</span><span class="n">kwargs</span><span class="p">)</span><span class="p">:</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="o">*</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">print</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">{0} has been used: {1}x</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="n">wrapper</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@counter</span>
<span class="nd">@benchmark</span>
<span class="nd">@logging</span>
<span class="k">def</span> <span class="nf">reverse_string</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="p">)</span>

<span class="k">print</span> <span class="n">reverse_string</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">Able was I ere I saw Elba</span><span class="s2">&#34;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">reverse_string</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">A man, a plan, a canoe, pasta, heros, rajahs, a coloratura, maps, snipe, percale, macaroni, a gag, a banana bag, a tan, a tag, a banana bag again (or a camel), a crepe, pins, Spam, a rut, a Rolo, cash, a jar, sore hats, a peon, a canal: Panama!</span><span class="s2">&#34;</span><span class="p">)</span>

<span class="c1">#outputs:</span>
<span class="c1">#reverse_string (&#39;Able was I ere I saw Elba&#39;,) {}</span>
<span class="c1">#wrapper 0.0</span>
<span class="c1">#wrapper has been used: 1x</span>
<span class="c1">#ablE was I ere I saw elbA</span>
<span class="c1">#reverse_string (&#39;A man, a plan, a canoe, pasta, heros, rajahs, a coloratura, maps, snipe, percale, macaroni, a gag, a banana bag, a tan, a tag, a banana bag again (or a camel), a crepe, pins, Spam, a rut, a Rolo, cash, a jar, sore hats, a peon, a canal: Panama!&#39;,) {}</span>
<span class="c1">#wrapper 0.0</span>
<span class="c1">#wrapper has been used: 2x</span>
<span class="c1">#!amanaP :lanac a ,noep a ,stah eros ,raj a ,hsac ,oloR a ,tur a ,mapS ,snip ,eperc a ,)lemac a ro( niaga gab ananab a ,gat a ,nat a ,gab ananab a ,gag a ,inoracam ,elacrep ,epins ,spam ,arutaroloc a ,shajar ,soreh ,atsap ,eonac a ,nalp a ,nam A</span>
</pre>
<p>Of course the good thing with decorators is that you can use them right away on almost anything without rewriting. DRY, I said:</p>
<pre class="chroma"><span class="nd">@counter</span>
<span class="nd">@benchmark</span>
<span class="nd">@logging</span>
<span class="k">def</span> <span class="nf">get_random_futurama_quote</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">urlopen</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">http://subfusion.net/cgi-bin/quote.pl?quote=futurama</span><span class="s2">&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">&lt;br&gt;&lt;b&gt;&lt;hr&gt;&lt;br&gt;</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">&lt;br&gt;&lt;br&gt;&lt;hr&gt;</span><span class="s2">&#34;</span><span class="p">)</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa"></span><span class="s2">&#34;</span><span class="s2">No, I</span><span class="s2">&#39;</span><span class="s2">m ... doesn</span><span class="s2">&#39;</span><span class="s2">t!</span><span class="s2">&#34;</span>


<span class="k">print</span> <span class="n">get_random_futurama_quote</span><span class="p">(</span><span class="p">)</span>
<span class="k">print</span> <span class="n">get_random_futurama_quote</span><span class="p">(</span><span class="p">)</span>

<span class="c1">#outputs:</span>
<span class="c1">#get_random_futurama_quote () {}</span>
<span class="c1">#wrapper 0.02</span>
<span class="c1">#wrapper has been used: 1x</span>
<span class="c1">#The laws of science be a harsh mistress.</span>
<span class="c1">#get_random_futurama_quote () {}</span>
<span class="c1">#wrapper 0.01</span>
<span class="c1">#wrapper has been used: 2x</span>
<span class="c1">#Curse you, merciful Poseidon!</span>
</pre>
<p>Python itself provides several decorators: property, staticmethod, etc.</p>
<pre class="chroma">Django uses decorators to manage caching and view permissions.
Twisted to fake inlining asynchronous functions calls.
</pre>
    </div>

  </div>
</body>

<footer>
    <div class="container">
        <div class="row footer-links">
            <div class="col-lg-2 col-sm-2">
                <h3>友情链接</h3>
                <ul>
                    <li><a href="">友链位招租</a></li>
                    <li><a href="">友链位招租</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>没想好</h3>
                <ul>
                    <li><a href="">我爸没想好</a></li>
                    <li><a href="">我哥说我爸没想好</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>Hooray</h3>
                <ul>
                    <li><a href="">Hooray</a></li>
                    <li><a href="">What are we Hooray For?</a></li>
                </ul>
            </div>
            <div class="col-lg-2 col-sm-2">
                <h3>前面的footer太浪了</h3>
                <ul>
                    <li><a href="">就是就是</a></li>
                    <li><a href="">偷偷的表示羡慕</a></li>
                </ul>
            </div>
            <div class="col-lg-4 col-sm-4">
                <h3>网站信息</h3>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <a class="" href="" target="_blank"></a>
                <div class="fine-print">
                    <p>网战由以下技术支撑</p>
                    <ul>
                        <li>Markdown Processor: <a href="https://github.com/russross/blackfriday/tree/v2">Blackfriday V2</a></li>
                        <li>Renderer Engine: <a href="https://github.com/Depado/bfchroma/">bfchroma</a></li>
                        <li>Syntax Highlighter: <a href="https://github.com/alecthomas/chroma">Chroma</a></li>
                        <li>Coding Language: <a href="https://go.dev/">Golang</a></li>
                        <li>Others: Markdown, HTML, CSS</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>

</html>